// File:js/lib/tether.min.js

/*! tether 0.6.5 */
!function(t,e){"function"==typeof define&&define.amd?define(e):"object"==typeof exports?module.exports=e(require,exports,module):t.Tether=e()}(this,function(){return function(){var t,e,o,i,n,s,l,r,h,a,f,p,u,d,g,c,m,b,v,y={}.hasOwnProperty,w=[].indexOf||function(t){for(var e=0,o=this.length;o>e;e++)if(e in this&&this[e]===t)return e;return-1},C=[].slice;null==this.Tether&&(this.Tether={modules:[]}),p=function(t){var e,o,i,n,s;if(o=getComputedStyle(t).position,"fixed"===o)return t;for(i=void 0,e=t;e=e.parentNode;){try{n=getComputedStyle(e)}catch(l){}if(null==n)return e;if(/(auto|scroll)/.test(n.overflow+n.overflowY+n.overflowX)&&("absolute"!==o||"relative"===(s=n.position)||"absolute"===s||"fixed"===s))return e}return document.body},m=function(){var t;return t=0,function(){return t++}}(),v={},a=function(t){var e,i,s,l,r;if(s=t._tetherZeroElement,null==s&&(s=t.createElement("div"),s.setAttribute("data-tether-id",m()),n(s.style,{top:0,left:0,position:"absolute"}),t.body.appendChild(s),t._tetherZeroElement=s),e=s.getAttribute("data-tether-id"),null==v[e]){v[e]={},r=s.getBoundingClientRect();for(i in r)l=r[i],v[e][i]=l;o(function(){return v[e]=void 0})}return v[e]},d=null,l=function(t){var e,o,i,n,s,l,r;t===document?(o=document,t=document.documentElement):o=t.ownerDocument,i=o.documentElement,e={},r=t.getBoundingClientRect();for(n in r)l=r[n],e[n]=l;return s=a(o),e.top-=s.top,e.left-=s.left,null==e.width&&(e.width=document.body.scrollWidth-e.left-e.right),null==e.height&&(e.height=document.body.scrollHeight-e.top-e.bottom),e.top=e.top-i.clientTop,e.left=e.left-i.clientLeft,e.right=o.body.clientWidth-e.width-e.left,e.bottom=o.body.clientHeight-e.height-e.top,e},h=function(t){return t.offsetParent||document.documentElement},f=function(){var t,e,o,i,s;return t=document.createElement("div"),t.style.width="100%",t.style.height="200px",e=document.createElement("div"),n(e.style,{position:"absolute",top:0,left:0,pointerEvents:"none",visibility:"hidden",width:"200px",height:"150px",overflow:"hidden"}),e.appendChild(t),document.body.appendChild(e),i=t.offsetWidth,e.style.overflow="scroll",s=t.offsetWidth,i===s&&(s=e.clientWidth),document.body.removeChild(e),o=i-s,{width:o,height:o}},n=function(t){var e,o,i,n,s,l,r;for(null==t&&(t={}),e=[],Array.prototype.push.apply(e,arguments),r=e.slice(1),s=0,l=r.length;l>s;s++)if(i=r[s])for(o in i)y.call(i,o)&&(n=i[o],t[o]=n);return t},g=function(t,e){var o,i,n,s,l,h;if(null!=t.classList){for(l=e.split(" "),h=[],n=0,s=l.length;s>n;n++)i=l[n],i.trim()&&h.push(t.classList.remove(i));return h}return o=r(t).replace(new RegExp("(^| )"+e.split(" ").join("|")+"( |$)","gi")," "),c(t,o)},e=function(t,e){var o,i,n,s,l;if(null!=t.classList){for(s=e.split(" "),l=[],i=0,n=s.length;n>i;i++)o=s[i],o.trim()&&l.push(t.classList.add(o));return l}return g(t,e),o=r(t)+(" "+e),c(t,o)},u=function(t,e){return null!=t.classList?t.classList.contains(e):new RegExp("(^| )"+e+"( |$)","gi").test(r(t))},r=function(t){return t.className instanceof SVGAnimatedString?t.className.baseVal:t.className},c=function(t,e){return t.setAttribute("class",e)},b=function(t,o,i){var n,s,l,r,h,a;for(s=0,r=i.length;r>s;s++)n=i[s],w.call(o,n)<0&&u(t,n)&&g(t,n);for(a=[],l=0,h=o.length;h>l;l++)n=o[l],a.push(u(t,n)?void 0:e(t,n));return a},i=[],o=function(t){return i.push(t)},s=function(){var t,e;for(e=[];t=i.pop();)e.push(t());return e},t=function(){function t(){}return t.prototype.on=function(t,e,o,i){var n;return null==i&&(i=!1),null==this.bindings&&(this.bindings={}),null==(n=this.bindings)[t]&&(n[t]=[]),this.bindings[t].push({handler:e,ctx:o,once:i})},t.prototype.once=function(t,e,o){return this.on(t,e,o,!0)},t.prototype.off=function(t,e){var o,i,n;if(null!=(null!=(i=this.bindings)?i[t]:void 0)){if(null==e)return delete this.bindings[t];for(o=0,n=[];o<this.bindings[t].length;)n.push(this.bindings[t][o].handler===e?this.bindings[t].splice(o,1):o++);return n}},t.prototype.trigger=function(){var t,e,o,i,n,s,l,r,h;if(o=arguments[0],t=2<=arguments.length?C.call(arguments,1):[],null!=(l=this.bindings)?l[o]:void 0){for(n=0,h=[];n<this.bindings[o].length;)r=this.bindings[o][n],i=r.handler,e=r.ctx,s=r.once,i.apply(null!=e?e:this,t),h.push(s?this.bindings[o].splice(n,1):n++);return h}},t}(),this.Tether.Utils={getScrollParent:p,getBounds:l,getOffsetParent:h,extend:n,addClass:e,removeClass:g,hasClass:u,updateClasses:b,defer:o,flush:s,uniqueId:m,Evented:t,getScrollBarSize:f}}.call(this),function(){var t,e,o,i,n,s,l,r,h,a,f,p,u,d,g,c,m,b,v,y,w,C,O,T,x,A,E,S,W,M=[].slice,z=function(t,e){return function(){return t.apply(e,arguments)}};if(null==this.Tether)throw new Error("You must include the utils.js file before tether.js");i=this.Tether,W=i.Utils,c=W.getScrollParent,m=W.getSize,d=W.getOuterSize,p=W.getBounds,u=W.getOffsetParent,a=W.extend,n=W.addClass,O=W.removeClass,A=W.updateClasses,h=W.defer,f=W.flush,g=W.getScrollBarSize,E=function(t,e,o){return null==o&&(o=1),t+o>=e&&e>=t-o},x=function(){var t,e,o,i,n;for(t=document.createElement("div"),n=["transform","webkitTransform","OTransform","MozTransform","msTransform"],o=0,i=n.length;i>o;o++)if(e=n[o],void 0!==t.style[e])return e}(),T=[],C=function(){var t,e,o;for(e=0,o=T.length;o>e;e++)t=T[e],t.position(!1);return f()},b=function(){var t;return null!=(t="undefined"!=typeof performance&&null!==performance&&"function"==typeof performance.now?performance.now():void 0)?t:+new Date},function(){var t,e,o,i,n,s,l,r,h;for(e=null,o=null,i=null,n=function(){if(null!=o&&o>16)return o=Math.min(o-16,250),void(i=setTimeout(n,250));if(!(null!=e&&b()-e<10))return null!=i&&(clearTimeout(i),i=null),e=b(),C(),o=b()-e},r=["resize","scroll","touchmove"],h=[],s=0,l=r.length;l>s;s++)t=r[s],h.push(window.addEventListener(t,n));return h}(),t={center:"center",left:"right",right:"left"},e={middle:"middle",top:"bottom",bottom:"top"},o={top:0,left:0,middle:"50%",center:"50%",bottom:"100%",right:"100%"},r=function(o,i){var n,s;return n=o.left,s=o.top,"auto"===n&&(n=t[i.left]),"auto"===s&&(s=e[i.top]),{left:n,top:s}},l=function(t){var e,i;return{left:null!=(e=o[t.left])?e:t.left,top:null!=(i=o[t.top])?i:t.top}},s=function(){var t,e,o,i,n,s,l;for(e=1<=arguments.length?M.call(arguments,0):[],o={top:0,left:0},n=0,s=e.length;s>n;n++)l=e[n],i=l.top,t=l.left,"string"==typeof i&&(i=parseFloat(i,10)),"string"==typeof t&&(t=parseFloat(t,10)),o.top+=i,o.left+=t;return o},v=function(t,e){return"string"==typeof t.left&&-1!==t.left.indexOf("%")&&(t.left=parseFloat(t.left,10)/100*e.width),"string"==typeof t.top&&-1!==t.top.indexOf("%")&&(t.top=parseFloat(t.top,10)/100*e.height),t},y=w=function(t){var e,o,i;return i=t.split(" "),o=i[0],e=i[1],{top:o,left:e}},S=function(){function t(t){this.position=z(this.position,this);var e,o,n,s,l;for(T.push(this),this.history=[],this.setOptions(t,!1),s=i.modules,o=0,n=s.length;n>o;o++)e=s[o],null!=(l=e.initialize)&&l.call(this);this.position()}return t.modules=[],t.prototype.getClass=function(t){var e,o;return(null!=(e=this.options.classes)?e[t]:void 0)?this.options.classes[t]:(null!=(o=this.options.classes)?o[t]:void 0)!==!1?this.options.classPrefix?""+this.options.classPrefix+"-"+t:t:""},t.prototype.setOptions=function(t,e){var o,i,s,l,r,h;for(this.options=t,null==e&&(e=!0),o={offset:"0 0",targetOffset:"0 0",targetAttachment:"auto auto",classPrefix:"tether"},this.options=a(o,this.options),r=this.options,this.element=r.element,this.target=r.target,this.targetModifier=r.targetModifier,"viewport"===this.target?(this.target=document.body,this.targetModifier="visible"):"scroll-handle"===this.target&&(this.target=document.body,this.targetModifier="scroll-handle"),h=["element","target"],s=0,l=h.length;l>s;s++){if(i=h[s],null==this[i])throw new Error("Tether Error: Both element and target must be defined");null!=this[i].jquery?this[i]=this[i][0]:"string"==typeof this[i]&&(this[i]=document.querySelector(this[i]))}if(n(this.element,this.getClass("element")),n(this.target,this.getClass("target")),!this.options.attachment)throw new Error("Tether Error: You must provide an attachment");return this.targetAttachment=y(this.options.targetAttachment),this.attachment=y(this.options.attachment),this.offset=w(this.options.offset),this.targetOffset=w(this.options.targetOffset),null!=this.scrollParent&&this.disable(),this.scrollParent="scroll-handle"===this.targetModifier?this.target:c(this.target),this.options.enabled!==!1?this.enable(e):void 0},t.prototype.getTargetBounds=function(){var t,e,o,i,n,s,l,r,h;if(null==this.targetModifier)return p(this.target);switch(this.targetModifier){case"visible":return this.target===document.body?{top:pageYOffset,left:pageXOffset,height:innerHeight,width:innerWidth}:(t=p(this.target),n={height:t.height,width:t.width,top:t.top,left:t.left},n.height=Math.min(n.height,t.height-(pageYOffset-t.top)),n.height=Math.min(n.height,t.height-(t.top+t.height-(pageYOffset+innerHeight))),n.height=Math.min(innerHeight,n.height),n.height-=2,n.width=Math.min(n.width,t.width-(pageXOffset-t.left)),n.width=Math.min(n.width,t.width-(t.left+t.width-(pageXOffset+innerWidth))),n.width=Math.min(innerWidth,n.width),n.width-=2,n.top<pageYOffset&&(n.top=pageYOffset),n.left<pageXOffset&&(n.left=pageXOffset),n);case"scroll-handle":return h=this.target,h===document.body?(h=document.documentElement,t={left:pageXOffset,top:pageYOffset,height:innerHeight,width:innerWidth}):t=p(h),r=getComputedStyle(h),o=h.scrollWidth>h.clientWidth||"scroll"===[r.overflow,r.overflowX]||this.target!==document.body,s=0,o&&(s=15),i=t.height-parseFloat(r.borderTopWidth)-parseFloat(r.borderBottomWidth)-s,n={width:15,height:.975*i*(i/h.scrollHeight),left:t.left+t.width-parseFloat(r.borderLeftWidth)-15},e=0,408>i&&this.target===document.body&&(e=-11e-5*Math.pow(i,2)-.00727*i+22.58),this.target!==document.body&&(n.height=Math.max(n.height,24)),l=this.target.scrollTop/(h.scrollHeight-i),n.top=l*(i-n.height-e)+t.top+parseFloat(r.borderTopWidth),this.target===document.body&&(n.height=Math.max(n.height,24)),n}},t.prototype.clearCache=function(){return this._cache={}},t.prototype.cache=function(t,e){return null==this._cache&&(this._cache={}),null==this._cache[t]&&(this._cache[t]=e.call(this)),this._cache[t]},t.prototype.enable=function(t){return null==t&&(t=!0),n(this.target,this.getClass("enabled")),n(this.element,this.getClass("enabled")),this.enabled=!0,this.scrollParent!==document&&this.scrollParent.addEventListener("scroll",this.position),t?this.position():void 0},t.prototype.disable=function(){return O(this.target,this.getClass("enabled")),O(this.element,this.getClass("enabled")),this.enabled=!1,null!=this.scrollParent?this.scrollParent.removeEventListener("scroll",this.position):void 0},t.prototype.destroy=function(){var t,e,o,i,n;for(this.disable(),n=[],t=o=0,i=T.length;i>o;t=++o){if(e=T[t],e===this){T.splice(t,1);break}n.push(void 0)}return n},t.prototype.updateAttachClasses=function(t,e){var o,i,n,s,l,r,a,f,p,u=this;for(null==t&&(t=this.attachment),null==e&&(e=this.targetAttachment),s=["left","top","bottom","right","middle","center"],(null!=(p=this._addAttachClasses)?p.length:void 0)&&this._addAttachClasses.splice(0,this._addAttachClasses.length),o=null!=this._addAttachClasses?this._addAttachClasses:this._addAttachClasses=[],t.top&&o.push(""+this.getClass("element-attached")+"-"+t.top),t.left&&o.push(""+this.getClass("element-attached")+"-"+t.left),e.top&&o.push(""+this.getClass("target-attached")+"-"+e.top),e.left&&o.push(""+this.getClass("target-attached")+"-"+e.left),i=[],l=0,a=s.length;a>l;l++)n=s[l],i.push(""+this.getClass("element-attached")+"-"+n);for(r=0,f=s.length;f>r;r++)n=s[r],i.push(""+this.getClass("target-attached")+"-"+n);return h(function(){return null!=u._addAttachClasses?(A(u.element,u._addAttachClasses,i),A(u.target,u._addAttachClasses,i),u._addAttachClasses=void 0):void 0})},t.prototype.position=function(t){var e,o,n,h,a,d,c,m,b,y,w,C,O,T,x,A,E,S,W,M,z,B,P,_,F,L,Y,H,X,N,j,R,U,q,k,D=this;if(null==t&&(t=!0),this.enabled){for(this.clearCache(),M=r(this.targetAttachment,this.attachment),this.updateAttachClasses(this.attachment,M),e=this.cache("element-bounds",function(){return p(D.element)}),F=e.width,n=e.height,0===F&&0===n&&null!=this.lastSize?(N=this.lastSize,F=N.width,n=N.height):this.lastSize={width:F,height:n},P=B=this.cache("target-bounds",function(){return D.getTargetBounds()}),b=v(l(this.attachment),{width:F,height:n}),z=v(l(M),P),a=v(this.offset,{width:F,height:n}),d=v(this.targetOffset,P),b=s(b,a),z=s(z,d),h=B.left+z.left-b.left,_=B.top+z.top-b.top,j=i.modules,L=0,H=j.length;H>L;L++)if(c=j[L],x=c.position.call(this,{left:h,top:_,targetAttachment:M,targetPos:B,attachment:this.attachment,elementPos:e,offset:b,targetOffset:z,manualOffset:a,manualTargetOffset:d,scrollbarSize:S}),null!=x&&"object"==typeof x){if(x===!1)return!1;_=x.top,h=x.left}if(m={page:{top:_,left:h},viewport:{top:_-pageYOffset,bottom:pageYOffset-_-n+innerHeight,left:h-pageXOffset,right:pageXOffset-h-F+innerWidth}},document.body.scrollWidth>window.innerWidth&&(S=this.cache("scrollbar-size",g),m.viewport.bottom-=S.height),document.body.scrollHeight>window.innerHeight&&(S=this.cache("scrollbar-size",g),m.viewport.right-=S.width),(""!==(R=document.body.style.position)&&"static"!==R||""!==(U=document.body.parentElement.style.position)&&"static"!==U)&&(m.page.bottom=document.body.scrollHeight-_-n,m.page.right=document.body.scrollWidth-h-F),(null!=(q=this.options.optimizations)?q.moveElement:void 0)!==!1&&null==this.targetModifier){for(w=this.cache("target-offsetparent",function(){return u(D.target)}),T=this.cache("target-offsetparent-bounds",function(){return p(w)}),O=getComputedStyle(w),o=getComputedStyle(this.element),C=T,y={},k=["Top","Left","Bottom","Right"],Y=0,X=k.length;X>Y;Y++)W=k[Y],y[W.toLowerCase()]=parseFloat(O["border"+W+"Width"]);T.right=document.body.scrollWidth-T.left-C.width+y.right,T.bottom=document.body.scrollHeight-T.top-C.height+y.bottom,m.page.top>=T.top+y.top&&m.page.bottom>=T.bottom&&m.page.left>=T.left+y.left&&m.page.right>=T.right&&(E=w.scrollTop,A=w.scrollLeft,m.offset={top:m.page.top-T.top+E-y.top,left:m.page.left-T.left+A-y.left})}return this.move(m),this.history.unshift(m),this.history.length>3&&this.history.pop(),t&&f(),!0}},t.prototype.move=function(t){var e,o,i,n,s,l,r,f,p,d,g,c,m,b,v,y,w,C=this;if(null!=this.element.parentNode){f={};for(d in t){f[d]={};for(n in t[d]){for(i=!1,y=this.history,b=0,v=y.length;v>b;b++)if(r=y[b],!E(null!=(w=r[d])?w[n]:void 0,t[d][n])){i=!0;break}i||(f[d][n]=!0)}}e={top:"",left:"",right:"",bottom:""},p=function(t,o){var i,n,s;return(null!=(s=C.options.optimizations)?s.gpu:void 0)===!1?(t.top?e.top=""+o.top+"px":e.bottom=""+o.bottom+"px",t.left?e.left=""+o.left+"px":e.right=""+o.right+"px"):(t.top?(e.top=0,n=o.top):(e.bottom=0,n=-o.bottom),t.left?(e.left=0,i=o.left):(e.right=0,i=-o.right),e[x]="translateX("+Math.round(i)+"px) translateY("+Math.round(n)+"px)","msTransform"!==x?e[x]+=" translateZ(0)":void 0)},s=!1,(f.page.top||f.page.bottom)&&(f.page.left||f.page.right)?(e.position="absolute",p(f.page,t.page)):(f.viewport.top||f.viewport.bottom)&&(f.viewport.left||f.viewport.right)?(e.position="fixed",p(f.viewport,t.viewport)):null!=f.offset&&f.offset.top&&f.offset.left?(e.position="absolute",l=this.cache("target-offsetparent",function(){return u(C.target)}),u(this.element)!==l&&h(function(){return C.element.parentNode.removeChild(C.element),l.appendChild(C.element)}),p(f.offset,t.offset),s=!0):(e.position="absolute",p({top:!0,left:!0},t.page)),s||"BODY"===this.element.parentNode.tagName||(this.element.parentNode.removeChild(this.element),document.body.appendChild(this.element)),m={},c=!1;for(n in e)g=e[n],o=this.element.style[n],""===o||""===g||"top"!==n&&"left"!==n&&"bottom"!==n&&"right"!==n||(o=parseFloat(o),g=parseFloat(g)),o!==g&&(c=!0,m[n]=e[n]);return c?h(function(){return a(C.element.style,m)}):void 0}},t}(),i.position=C,this.Tether=a(S,i)}.call(this),function(){var t,e,o,i,n,s,l,r,h,a,f=[].indexOf||function(t){for(var e=0,o=this.length;o>e;e++)if(e in this&&this[e]===t)return e;return-1};a=this.Tether.Utils,l=a.getOuterSize,s=a.getBounds,r=a.getSize,i=a.extend,h=a.updateClasses,o=a.defer,e={left:"right",right:"left",top:"bottom",bottom:"top",middle:"middle"},t=["left","top","right","bottom"],n=function(e,o){var i,n,l,r,h,a,f;if("scrollParent"===o?o=e.scrollParent:"window"===o&&(o=[pageXOffset,pageYOffset,innerWidth+pageXOffset,innerHeight+pageYOffset]),o===document&&(o=o.documentElement),null!=o.nodeType)for(n=r=s(o),h=getComputedStyle(o),o=[n.left,n.top,r.width+n.left,r.height+n.top],i=a=0,f=t.length;f>a;i=++a)l=t[i],l=l[0].toUpperCase()+l.substr(1),"Top"===l||"Left"===l?o[i]+=parseFloat(h["border"+l+"Width"]):o[i]-=parseFloat(h["border"+l+"Width"]);return o},this.Tether.modules.push({position:function(e){var l,r,a,p,u,d,g,c,m,b,v,y,w,C,O,T,x,A,E,S,W,M,z,B,P,_,F,L,Y,H,X,N,j,R,U,q,k,D,Z,V,$,G,I,J,K,Q,te,ee=this;if(_=e.top,v=e.left,W=e.targetAttachment,!this.options.constraints)return!0;for(A=function(e){var o,i,n,s;for(ee.removeClass(e),s=[],i=0,n=t.length;n>i;i++)o=t[i],s.push(ee.removeClass(""+e+"-"+o));return s},V=this.cache("element-bounds",function(){return s(ee.element)}),b=V.height,F=V.width,0===F&&0===b&&null!=this.lastSize&&($=this.lastSize,F=$.width,b=$.height),z=this.cache("target-bounds",function(){return ee.getTargetBounds()}),M=z.height,B=z.width,S={},m={},r=[this.getClass("pinned"),this.getClass("out-of-bounds")],G=this.options.constraints,L=0,N=G.length;N>L;L++)c=G[L],c.outOfBoundsClass&&r.push(c.outOfBoundsClass),c.pinnedClass&&r.push(c.pinnedClass);for(Y=0,j=r.length;j>Y;Y++)for(g=r[Y],I=["left","top","right","bottom"],H=0,R=I.length;R>H;H++)E=I[H],r.push(""+g+"-"+E);for(l=[],S=i({},W),m=i({},this.attachment),J=this.options.constraints,X=0,U=J.length;U>X;X++){if(c=J[X],P=c.to,a=c.attachment,O=c.pin,null==a&&(a=""),f.call(a," ")>=0?(K=a.split(" "),d=K[0],u=K[1]):u=d=a,p=n(this,P),("target"===d||"both"===d)&&(_<p[1]&&"top"===S.top&&(_+=M,S.top="bottom"),_+b>p[3]&&"bottom"===S.top&&(_-=M,S.top="top")),"together"===d&&(_<p[1]&&"top"===S.top&&("bottom"===m.top?(_+=M,S.top="bottom",_+=b,m.top="top"):"top"===m.top&&(_+=M,S.top="bottom",_-=b,m.top="bottom")),_+b>p[3]&&"bottom"===S.top&&("top"===m.top?(_-=M,S.top="top",_-=b,m.top="bottom"):"bottom"===m.top&&(_-=M,S.top="top",_+=b,m.top="top")),"middle"===S.top&&(_+b>p[3]&&"top"===m.top?(_-=b,m.top="bottom"):_<p[1]&&"bottom"===m.top&&(_+=b,m.top="top"))),("target"===u||"both"===u)&&(v<p[0]&&"left"===S.left&&(v+=B,S.left="right"),v+F>p[2]&&"right"===S.left&&(v-=B,S.left="left")),"together"===u&&(v<p[0]&&"left"===S.left?"right"===m.left?(v+=B,S.left="right",v+=F,m.left="left"):"left"===m.left&&(v+=B,S.left="right",v-=F,m.left="right"):v+F>p[2]&&"right"===S.left?"left"===m.left?(v-=B,S.left="left",v-=F,m.left="right"):"right"===m.left&&(v-=B,S.left="left",v+=F,m.left="left"):"center"===S.left&&(v+F>p[2]&&"left"===m.left?(v-=F,m.left="right"):v<p[0]&&"right"===m.left&&(v+=F,m.left="left"))),("element"===d||"both"===d)&&(_<p[1]&&"bottom"===m.top&&(_+=b,m.top="top"),_+b>p[3]&&"top"===m.top&&(_-=b,m.top="bottom")),("element"===u||"both"===u)&&(v<p[0]&&"right"===m.left&&(v+=F,m.left="left"),v+F>p[2]&&"left"===m.left&&(v-=F,m.left="right")),"string"==typeof O?O=function(){var t,e,o,i;for(o=O.split(","),i=[],e=0,t=o.length;t>e;e++)C=o[e],i.push(C.trim());return i}():O===!0&&(O=["top","left","right","bottom"]),O||(O=[]),T=[],y=[],_<p[1]&&(f.call(O,"top")>=0?(_=p[1],T.push("top")):y.push("top")),_+b>p[3]&&(f.call(O,"bottom")>=0?(_=p[3]-b,T.push("bottom")):y.push("bottom")),v<p[0]&&(f.call(O,"left")>=0?(v=p[0],T.push("left")):y.push("left")),v+F>p[2]&&(f.call(O,"right")>=0?(v=p[2]-F,T.push("right")):y.push("right")),T.length)for(x=null!=(Q=this.options.pinnedClass)?Q:this.getClass("pinned"),l.push(x),D=0,q=T.length;q>D;D++)E=T[D],l.push(""+x+"-"+E);if(y.length)for(w=null!=(te=this.options.outOfBoundsClass)?te:this.getClass("out-of-bounds"),l.push(w),Z=0,k=y.length;k>Z;Z++)E=y[Z],l.push(""+w+"-"+E);(f.call(T,"left")>=0||f.call(T,"right")>=0)&&(m.left=S.left=!1),(f.call(T,"top")>=0||f.call(T,"bottom")>=0)&&(m.top=S.top=!1),(S.top!==W.top||S.left!==W.left||m.top!==this.attachment.top||m.left!==this.attachment.left)&&this.updateAttachClasses(m,S)}return o(function(){return h(ee.target,l,r),h(ee.element,l,r)}),{top:_,left:v}}})}.call(this),function(){var t,e,o,i;i=this.Tether.Utils,e=i.getBounds,o=i.updateClasses,t=i.defer,this.Tether.modules.push({position:function(i){var n,s,l,r,h,a,f,p,u,d,g,c,m,b,v,y,w,C,O,T,x,A,E,S,W,M=this;if(g=i.top,a=i.left,x=this.cache("element-bounds",function(){return e(M.element)}),h=x.height,c=x.width,d=this.getTargetBounds(),r=g+h,f=a+c,n=[],g<=d.bottom&&r>=d.top)for(A=["left","right"],m=0,w=A.length;w>m;m++)p=A[m],((E=d[p])===a||E===f)&&n.push(p);if(a<=d.right&&f>=d.left)for(S=["top","bottom"],b=0,C=S.length;C>b;b++)p=S[b],((W=d[p])===g||W===r)&&n.push(p);for(l=[],s=[],u=["left","top","right","bottom"],l.push(this.getClass("abutted")),v=0,O=u.length;O>v;v++)p=u[v],l.push(""+this.getClass("abutted")+"-"+p);for(n.length&&s.push(this.getClass("abutted")),y=0,T=n.length;T>y;y++)p=n[y],s.push(""+this.getClass("abutted")+"-"+p);return t(function(){return o(M.target,s,l),o(M.element,s,l)}),!0}})}.call(this),function(){this.Tether.modules.push({position:function(t){var e,o,i,n,s,l,r;return l=t.top,e=t.left,this.options.shift?(o=function(t){return"function"==typeof t?t.call(this,{top:l,left:e}):t},i=o(this.options.shift),"string"==typeof i?(i=i.split(" "),i[1]||(i[1]=i[0]),s=i[0],n=i[1],s=parseFloat(s,10),n=parseFloat(n,10)):(r=[i.top,i.left],s=r[0],n=r[1]),l+=s,e+=n,{top:l,left:e}):void 0}})}.call(this),this.Tether});
// File:js/lib/colorpicker.min.js

(function(k,p,n){function w(a){if(k.event&&k.event.contentOverflow!==n)return{x:k.event.offsetX,y:k.event.offsetY};if(a.offsetX!==n&&a.offsetY!==n)return{x:a.offsetX,y:a.offsetY};var b=a.target.parentNode.parentNode;return{x:a.layerX-b.offsetLeft,y:a.layerY-b.offsetTop}}function e(a,b,c){a=p.createElementNS("http://www.w3.org/2000/svg",a);for(var d in b)a.setAttribute(d,b[d]);"[object Array]"!=Object.prototype.toString.call(c)&&(c=[c]);b=0;for(d=c[0]&&c.length||0;b<d;b++)a.appendChild(c[b]);return a}
function l(a){var b,c,d,g,f=a.h%360/60;g=a.v*a.s;d=g*(1-Math.abs(f%2-1));b=c=a=a.v-g;f=~~f;b+=[g,d,0,0,d,g][f];c+=[d,g,g,d,0,0][f];a+=[0,0,d,g,g,d][f];d=Math.floor(255*b);c=Math.floor(255*c);a=Math.floor(255*a);return{r:d,g:c,b:a,hex:"#"+(16777216|a|c<<8|d<<16).toString(16).slice(1)}}function q(a){var b=a.r,c=a.g,d=a.b;if(1<a.r||1<a.g||1<a.b)b/=255,c/=255,d/=255;var g;a=Math.max(b,c,d);g=a-Math.min(b,c,d);b=(0==g?0:a==b?(c-d)/g+(c<d?6:0):a==c?(d-b)/g+2:(b-c)/g+4)%6*60;return{h:b,s:0==g?0:g/a,v:a}}
function x(a,b,c){return function(d){d=d||k.event;d=w(d);a.h=d.y/b.offsetHeight*360+15;var g=l({h:a.h,s:1,v:1}),f=l({h:a.h,s:a.s,v:a.v});c.style.backgroundColor=g.hex;a.callback&&a.callback(f.hex,{h:a.h-15,s:a.s,v:a.v},{r:f.r,g:f.g,b:f.b},n,d)}}function y(a,b){return function(c){c=c||k.event;c=w(c);var d=b.offsetHeight;a.s=c.x/b.offsetWidth;a.v=(d-c.y)/d;d=l(a);a.callback&&a.callback(d.hex,{h:a.h-15,s:a.s,v:a.v},{r:d.r,g:d.g,b:d.b},c)}}function h(a,b,c){if(!(this instanceof h))return new h(a,b,c);
this.h=0;this.v=this.s=1;if(c)this.callback=c,this.pickerElement=b,this.slideElement=a;else{a.innerHTML='<div class="picker-wrapper"><div class="picker"></div><div class="picker-indicator"></div></div><div class="slide-wrapper"><div class="slide"></div><div class="slide-indicator"></div></div>';this.slideElement=a.getElementsByClassName("slide")[0];this.pickerElement=a.getElementsByClassName("picker")[0];var d=a.getElementsByClassName("slide-indicator")[0],g=a.getElementsByClassName("picker-indicator")[0];
h.fixIndicators(d,g);this.callback=function(a,c,e,f,k){h.positionIndicators(d,g,k,f);b(a,c,e)}}if("SVG"==u){a=r.cloneNode(!0);c=s.cloneNode(!0);var f=a.getElementById("gradient-hsv"),e=a.getElementsByTagName("rect")[0];f.id="gradient-hsv-"+t;e.setAttribute("fill","url(#"+f.id+")");f=[c.getElementById("gradient-black"),c.getElementById("gradient-white")];e=c.getElementsByTagName("rect");f[0].id="gradient-black-"+t;f[1].id="gradient-white-"+t;e[0].setAttribute("fill","url(#"+f[1].id+")");e[1].setAttribute("fill",
"url(#"+f[0].id+")");this.slideElement.appendChild(a);this.pickerElement.appendChild(c);t++}else this.slideElement.innerHTML=r,this.pickerElement.innerHTML=s;m(this.slideElement,"click",x(this,this.slideElement,this.pickerElement));m(this.pickerElement,"click",y(this,this.pickerElement));z(this,this.slideElement,x(this,this.slideElement,this.pickerElement));z(this,this.pickerElement,y(this,this.pickerElement))}function m(a,b,c){a.attachEvent?a.attachEvent("on"+b,c):a.addEventListener&&a.addEventListener(b,
c,!1)}function z(a,b,c){var d=!1;m(b,"mousedown",function(a){d=!0});m(b,"mouseup",function(a){d=!1});m(b,"mouseout",function(a){d=!1});m(b,"mousemove",function(a){d&&c(a)})}function v(a,b,c,d){a.h=b.h%360;a.s=b.s;a.v=b.v;b=l(a);var e={y:a.h*a.slideElement.offsetHeight/360,x:0},f=a.pickerElement.offsetHeight,f={x:a.s*a.pickerElement.offsetWidth,y:f-a.v*f};a.pickerElement.style.backgroundColor=l({h:a.h,s:1,v:1}).hex;a.callback&&a.callback(d||b.hex,{h:a.h,s:a.s,v:a.v},c||{r:b.r,g:b.g,b:b.b},f,e);return a}
var u=k.SVGAngle||p.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")?"SVG":"VML",s,r;"SVG"==u?(r=e("svg",{xmlns:"http://www.w3.org/2000/svg",version:"1.1",width:"100%",height:"100%"},[e("defs",{},e("linearGradient",{id:"gradient-hsv",x1:"0%",y1:"100%",x2:"0%",y2:"0%"},[e("stop",{offset:"0%","stop-color":"#FF0000","stop-opacity":"1"}),e("stop",{offset:"13%","stop-color":"#FF00FF","stop-opacity":"1"}),e("stop",{offset:"25%","stop-color":"#8000FF","stop-opacity":"1"}),
e("stop",{offset:"38%","stop-color":"#0040FF","stop-opacity":"1"}),e("stop",{offset:"50%","stop-color":"#00FFFF","stop-opacity":"1"}),e("stop",{offset:"63%","stop-color":"#00FF40","stop-opacity":"1"}),e("stop",{offset:"75%","stop-color":"#0BED00","stop-opacity":"1"}),e("stop",{offset:"88%","stop-color":"#FFFF00","stop-opacity":"1"}),e("stop",{offset:"100%","stop-color":"#FF0000","stop-opacity":"1"})])),e("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:"url(#gradient-hsv)"})]),s=e("svg",{xmlns:"http://www.w3.org/2000/svg",
version:"1.1",width:"100%",height:"100%"},[e("defs",{},[e("linearGradient",{id:"gradient-black",x1:"0%",y1:"100%",x2:"0%",y2:"0%"},[e("stop",{offset:"0%","stop-color":"#000000","stop-opacity":"1"}),e("stop",{offset:"100%","stop-color":"#CC9A81","stop-opacity":"0"})]),e("linearGradient",{id:"gradient-white",x1:"0%",y1:"100%",x2:"100%",y2:"100%"},[e("stop",{offset:"0%","stop-color":"#FFFFFF","stop-opacity":"1"}),e("stop",{offset:"100%","stop-color":"#CC9A81","stop-opacity":"0"})])]),e("rect",{x:"0",
y:"0",width:"100%",height:"100%",fill:"url(#gradient-white)"}),e("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:"url(#gradient-black)"})])):"VML"==u&&(r='<DIV style="position: relative; width: 100%; height: 100%"><v:rect style="position: absolute; top: 0; left: 0; width: 100%; height: 100%" stroked="f" filled="t"><v:fill type="gradient" method="none" angle="0" color="red" color2="red" colors="8519f fuchsia;.25 #8000ff;24903f #0040ff;.5 aqua;41287f #00ff40;.75 #0bed00;57671f yellow"></v:fill></v:rect></DIV>',
s='<DIV style="position: relative; width: 100%; height: 100%"><v:rect style="position: absolute; left: -1px; top: -1px; width: 101%; height: 101%" stroked="f" filled="t"><v:fill type="gradient" method="none" angle="270" color="#FFFFFF" opacity="100%" color2="#CC9A81" o:opacity2="0%"></v:fill></v:rect><v:rect style="position: absolute; left: 0px; top: 0px; width: 100%; height: 101%" stroked="f" filled="t"><v:fill type="gradient" method="none" angle="0" color="#000000" opacity="100%" color2="#CC9A81" o:opacity2="0%"></v:fill></v:rect></DIV>',
p.namespaces.v||p.namespaces.add("v","urn:schemas-microsoft-com:vml","#default#VML"));var t=0;h.hsv2rgb=function(a){a=l(a);delete a.hex;return a};h.hsv2hex=function(a){return l(a).hex};h.rgb2hsv=q;h.rgb2hex=function(a){return l(q(a)).hex};h.hex2hsv=function(a){return q(h.hex2rgb(a))};h.hex2rgb=function(a){return{r:parseInt(a.substr(1,2),16),g:parseInt(a.substr(3,2),16),b:parseInt(a.substr(5,2),16)}};h.prototype.setHsv=function(a){return v(this,a)};h.prototype.setRgb=function(a){return v(this,q(a),
a)};h.prototype.setHex=function(a){return v(this,h.hex2hsv(a),n,a)};h.positionIndicators=function(a,b,c,d){c&&(a.style.top=c.y-a.offsetHeight/2+"px");d&&(b.style.top=d.y-b.offsetHeight/2+"px",b.style.left=d.x-b.offsetWidth/2+"px")};h.fixIndicators=function(a,b){b.style.pointerEvents="none";a.style.pointerEvents="none"};k.ColorPicker=h})(window,window.document);

// File:js/lib/vlist.min.js

function VirtualList(a){var b=a&&a.w+"px"||"100%",c=a&&a.h+"px"||"100%",d=this.itemHeight=a.itemHeight;this.items=a.items;this.generatorFn=a.generatorFn;this.totalRows=a.totalRows||a.items&&a.items.length;var e=VirtualList.createScroller(d*this.totalRows);this.container=VirtualList.createContainer(b,c);this.container.appendChild(e);var f=Math.ceil(a.h/d);this.cachedItemsLen=3*f;this._renderChunk(this.container,0);var g=this,h,l=f*d,k=0;this.rmNodeInterval=setInterval(function(){if(100<Date.now()-
k)for(var a=document.querySelectorAll('[data-rm="1"]'),b=0,c=a.length;b<c;b++)g.container.removeChild(a[b])},300);this.container.addEventListener("scroll",function(a){var b=a.target.scrollTop;if(!h||Math.abs(b-h)>l){var c=parseInt(b/d)-f;g._renderChunk(g.container,0>c?0:c);h=b}k=Date.now();a.preventDefault&&a.preventDefault()})}
VirtualList.prototype.createRow=function(a){var b;if(this.generatorFn)b=this.generatorFn(a);else if(this.items)if("string"===typeof this.items[a]){var c=document.createTextNode(this.items[a]);b=document.createElement("div");b.style.height=this.itemHeight+"px";b.appendChild(c)}else b=this.items[a];b.classList.add("vrow");b.style.position="absolute";b.style.top=a*this.itemHeight+"px";return b};
VirtualList.prototype._renderChunk=function(a,b){var c=b+this.cachedItemsLen;c>this.totalRows&&(c=this.totalRows);for(var d=document.createDocumentFragment(),e=b;e<c;e++)d.appendChild(this.createRow(e));c=1;for(e=a.childNodes.length;c<e;c++)a.childNodes[c].style.display="none",a.childNodes[c].setAttribute("data-rm","1");a.appendChild(d)};
VirtualList.createContainer=function(a,b){var c=document.createElement("div");c.style.width=a;c.style.height=b;c.style.overflow="auto";c.style.position="relative";c.style.padding=0;return c};VirtualList.createScroller=function(a){var b=document.createElement("div");b.style.opacity=0;b.style.position="absolute";b.style.top=0;b.style.left=0;b.style.width="1px";b.style.height=a+"px";return b};

// File:js/build/gui-no-libs.min.js

// https://github.com/arose/ngl/ LICENSE
var UI={Element:function(){}};
UI.Element.prototype={setId:function(a){this.dom.id=a;return this},setTitle:function(a){this.dom.title=a;return this},setClass:function(a){this.dom.className=a;return this},setStyle:function(a,b){for(var c=0;c<b.length;c++)this.dom.style[a]=b[c]},getStyle:function(a){return this.dom.style[a]},getBox:function(){return this.dom.getBoundingClientRect()},setDisabled:function(a){this.dom.disabled=a;return this},setTextContent:function(a){this.dom.textContent=a;return this},dispose:function(){this.dom.parentNode.removeChild(this.dom)}};
var properties="position left top right bottom width height border borderLeft borderTop borderRight borderBottom borderColor display overflow margin marginLeft marginTop marginRight marginBottom padding paddingLeft paddingTop paddingRight paddingBottom color backgroundColor opacity fontSize fontWeight textTransform cursor verticalAlign clear float zIndex minHeight maxHeight minWidth maxWidth wordBreak wordWrap spellcheck lineHeight".split(" ");
properties.forEach(function(a){var b=a.substr(0,1).toUpperCase()+a.substr(1,a.length);UI.Element.prototype["set"+b]=function(){this.setStyle(a,arguments);return this};UI.Element.prototype["get"+b]=function(){return this.getStyle(a)}});var events="KeyUp KeyDown KeyPress MouseOver MouseOut Click Change Input".split(" ");events.forEach(function(a){UI.Element.prototype["on"+a]=function(b){this.dom.addEventListener(a.toLowerCase(),b.bind(this),!1);return this}});
UI.Panel=function(){UI.Element.call(this);var a=document.createElement("div");a.className="Panel";this.dom=a;return this};UI.Panel.prototype=Object.create(UI.Element.prototype);UI.Panel.prototype.add=function(){for(var a=0;a<arguments.length;a++)this.dom.appendChild(arguments[a].dom);return this};UI.Panel.prototype.remove=function(){for(var a=0;a<arguments.length;a++)this.dom.removeChild(arguments[a].dom);return this};
UI.Panel.prototype.clear=function(){for(;this.dom.children.length;)this.dom.removeChild(this.dom.lastChild);return this};
UI.CollapsiblePanel=function(){UI.Panel.call(this);this.dom.className="Panel CollapsiblePanel";this.button=document.createElement("div");this.button.className="CollapsiblePanelButton";this.dom.appendChild(this.button);var a=this;this.button.addEventListener("click",function(b){a.toggle()},!1);this.content=document.createElement("div");this.content.className="CollapsibleContent";this.dom.appendChild(this.content);this.isCollapsed=!1;return this};UI.CollapsiblePanel.prototype=Object.create(UI.Panel.prototype);
UI.CollapsiblePanel.prototype.addStatic=function(){for(var a=0;a<arguments.length;a++)this.dom.insertBefore(arguments[a].dom,this.content);return this};UI.CollapsiblePanel.prototype.removeStatic=UI.Panel.prototype.remove;UI.CollapsiblePanel.prototype.clearStatic=function(){this.dom.childNodes.forEach(function(a){a!==this.content&&this.dom.removeChild(a)})};UI.CollapsiblePanel.prototype.add=function(){for(var a=0;a<arguments.length;a++)this.content.appendChild(arguments[a].dom);return this};
UI.CollapsiblePanel.prototype.remove=function(){for(var a=0;a<arguments.length;a++)this.content.removeChild(arguments[a].dom);return this};UI.CollapsiblePanel.prototype.clear=function(){for(;this.content.children.length;)this.content.removeChild(this.content.lastChild)};UI.CollapsiblePanel.prototype.toggle=function(){this.setCollapsed(!this.isCollapsed)};UI.CollapsiblePanel.prototype.collapse=function(){this.setCollapsed(!0)};UI.CollapsiblePanel.prototype.expand=function(){this.setCollapsed(!1)};
UI.CollapsiblePanel.prototype.setCollapsed=function(a){a?this.dom.classList.add("collapsed"):this.dom.classList.remove("collapsed");this.isCollapsed=a};UI.Text=function(a){UI.Element.call(this);var b=document.createElement("span");b.className="Text";b.style.cursor="default";b.style.display="inline-block";b.style.verticalAlign="middle";this.dom=b;this.setValue(a);return this};UI.Text.prototype=Object.create(UI.Element.prototype);
UI.Text.prototype.setValue=function(a){void 0!==a&&(this.dom.textContent=a);return this};UI.Input=function(){UI.Element.call(this);var a=document.createElement("input");a.className="Input";a.style.padding="2px";a.style.border="1px solid #ccc";a.addEventListener("keydown",function(a){a.stopPropagation()},!1);this.dom=a;return this};UI.Input.prototype=Object.create(UI.Element.prototype);UI.Input.prototype.getValue=function(){return this.dom.value};
UI.Input.prototype.setValue=function(a){this.dom.value=a;return this};UI.TextArea=function(){UI.Element.call(this);var a=document.createElement("textarea");a.className="TextArea";a.style.padding="2px";a.style.border="1px solid #ccc";a.addEventListener("keydown",function(a){a.stopPropagation()},!1);this.dom=a;return this};UI.TextArea.prototype=Object.create(UI.Element.prototype);UI.TextArea.prototype.getValue=function(){return this.dom.value};
UI.TextArea.prototype.setValue=function(a){this.dom.value=a;return this};UI.Select=function(){UI.Element.call(this);var a=document.createElement("select");a.className="Select";a.style.width="64px";a.style.height="16px";a.style.border="0px";a.style.padding="0px";this.dom=a;return this};UI.Select.prototype=Object.create(UI.Element.prototype);UI.Select.prototype.setMultiple=function(a){this.dom.multiple=a;return this};
UI.Select.prototype.setOptions=function(a){for(var b=this.dom.value;0<this.dom.children.length;)this.dom.removeChild(this.dom.firstChild);for(var c in a){var d=document.createElement("option");d.value=c;d.innerHTML=a[c];this.dom.appendChild(d)}this.dom.value=b;return this};UI.Select.prototype.getValue=function(){return this.dom.value};UI.Select.prototype.setValue=function(a){this.dom.value=a;return this};
UI.FancySelect=function(){UI.Element.call(this);var a=this,b=document.createElement("div");b.className="FancySelect";b.tabIndex=0;var c=document.createEvent("HTMLEvents");c.initEvent("change",!0,!0);b.addEventListener("keydown",function(a){switch(a.keyCode){case 38:case 40:a.preventDefault(),a.stopPropagation()}},!1);b.addEventListener("keyup",function(b){switch(b.keyCode){case 38:case 40:a.selectedIndex+=38==b.keyCode?-1:1,0<=a.selectedIndex&&a.selectedIndex<a.options.length&&(a.setValue(a.options[a.selectedIndex].value),
a.dom.dispatchEvent(c))}},!1);this.dom=b;this.options=[];this.selectedIndex=-1;this.selectedValue=null;return this};UI.FancySelect.prototype=Object.create(UI.Element.prototype);
UI.FancySelect.prototype.setOptions=function(a){var b=this,c=document.createEvent("HTMLEvents");for(c.initEvent("change",!0,!0);0<b.dom.children.length;)b.dom.removeChild(b.dom.firstChild);b.options=[];for(var d=0;d<a.length;d++){var e=a[d],f=document.createElement("div");f.className="option";f.innerHTML=e.html;f.value=e.value;b.dom.appendChild(f);b.options.push(f);f.addEventListener("click",function(a){b.setValue(this.value);b.dom.dispatchEvent(c)},!1)}return b};
UI.FancySelect.prototype.getValue=function(){return this.selectedValue};UI.FancySelect.prototype.setValue=function(a){for(var b=0;b<this.options.length;b++){var c=this.options[b];if(c.value===a){c.classList.add("active");var d=c.offsetTop-this.dom.offsetTop,c=d+c.offsetHeight-this.dom.offsetHeight;this.dom.scrollTop>d?this.dom.scrollTop=d:this.dom.scrollTop<c&&(this.dom.scrollTop=c);this.selectedIndex=b}else c.classList.remove("active")}this.selectedValue=a;return this};
UI.Checkbox=function(a){UI.Element.call(this);var b=document.createElement("input");b.className="Checkbox";b.type="checkbox";this.dom=b;this.setValue(a);return this};UI.Checkbox.prototype=Object.create(UI.Element.prototype);UI.Checkbox.prototype.getValue=function(){return this.dom.checked};UI.Checkbox.prototype.setValue=function(a){void 0!==a&&(this.dom.checked=a);return this};
UI.Color=function(){UI.Element.call(this);var a=document.createElement("input");a.className="Color";a.style.width="64px";a.style.height="16px";a.style.border="0px";a.style.padding="0px";a.style.backgroundColor="transparent";try{a.type="color",a.value="#ffffff"}catch(b){}this.dom=a;return this};UI.Color.prototype=Object.create(UI.Element.prototype);UI.Color.prototype.getValue=function(){return this.dom.value};UI.Color.prototype.getHexValue=function(){return parseInt(this.dom.value.substr(1),16)};
UI.Color.prototype.setValue=function(a){this.dom.value=a;return this};UI.Color.prototype.setHexValue=function(a){this.dom.value="#"+("000000"+a.toString(16)).slice(-6);return this};
UI.Number=function(a){UI.Element.call(this);var b=this,c=document.createElement("input");c.className="Number";c.value="0.00";c.addEventListener("keydown",function(a){a.stopPropagation();13===a.keyCode&&c.blur()},!1);this.min=-Infinity;this.max=Infinity;this.precision=2;this.step=1;this.dom=c;this.setValue(a);var d=document.createEvent("HTMLEvents");d.initEvent("change",!0,!0);var e=0,f=0,g=new THREE.Vector2,h=new THREE.Vector2,l=function(a){var n=c.value;g.set(a.clientX,a.clientY);e+=g.x-h.x-(g.y-
h.y);var m=50;a.shiftKey&&(m=5);a.ctrlKey&&(m=500);c.value=Math.min(b.max,Math.max(b.min,f+e/m*b.step)).toFixed(b.precision);n!==c.value&&c.dispatchEvent(d);h.set(a.clientX,a.clientY)},k=function(a){document.removeEventListener("mousemove",l,!1);document.removeEventListener("mouseup",k,!1);2>Math.abs(e)&&(c.focus(),c.select())};c.addEventListener("mousedown",function(a){a.preventDefault();e=0;f=parseFloat(c.value);h.set(a.clientX,a.clientY);document.addEventListener("mousemove",l,!1);document.addEventListener("mouseup",
k,!1)},!1);c.addEventListener("change",function(a){a=parseFloat(c.value);c.value=!1===isNaN(a)?a:0},!1);c.addEventListener("focus",function(a){c.style.backgroundColor="";c.style.borderColor="#ccc";c.style.cursor=""},!1);c.addEventListener("blur",function(a){c.style.backgroundColor="transparent";c.style.borderColor="transparent";c.style.cursor="col-resize"},!1);return this};UI.Number.prototype=Object.create(UI.Element.prototype);UI.Number.prototype.getValue=function(){return parseFloat(this.dom.value)};
UI.Number.prototype.setValue=function(a){void 0!==a&&(this.dom.value=a.toFixed(this.precision));return this};UI.Number.prototype.setRange=function(a,b){this.min=a;this.max=b;return this};UI.Number.prototype.setPrecision=function(a){this.precision=a;return this};
UI.Integer=function(a){UI.Element.call(this);var b=this,c=document.createElement("input");c.className="Number";c.value="0.00";c.addEventListener("keydown",function(a){a.stopPropagation()},!1);this.min=-Infinity;this.max=Infinity;this.step=1;this.dom=c;this.setValue(a);var d=document.createEvent("HTMLEvents");d.initEvent("change",!0,!0);var e=0,f=0,g=new THREE.Vector2,h=new THREE.Vector2,l=function(a){var n=c.value;g.set(a.clientX,a.clientY);e+=g.x-h.x-(g.y-h.y);var m=50;a.shiftKey&&(m=5);a.ctrlKey&&
(m=500);c.value=Math.min(b.max,Math.max(b.min,f+e/m*b.step))|0;n!==c.value&&c.dispatchEvent(d);h.set(a.clientX,a.clientY)},k=function(a){document.removeEventListener("mousemove",l,!1);document.removeEventListener("mouseup",k,!1);2>Math.abs(e)&&(c.focus(),c.select())};c.addEventListener("mousedown",function(a){a.preventDefault();e=0;f=parseFloat(c.value);h.set(a.clientX,a.clientY);document.addEventListener("mousemove",l,!1);document.addEventListener("mouseup",k,!1)},!1);c.addEventListener("change",
function(a){a=parseInt(c.value);!1===isNaN(a)&&(c.value=a)},!1);c.addEventListener("focus",function(a){c.style.backgroundColor="";c.style.borderColor="#ccc";c.style.cursor=""},!1);c.addEventListener("blur",function(a){c.style.backgroundColor="transparent";c.style.borderColor="transparent";c.style.cursor="col-resize"},!1);return this};UI.Integer.prototype=Object.create(UI.Element.prototype);UI.Integer.prototype.getValue=function(){return parseInt(this.dom.value)};
UI.Integer.prototype.setValue=function(a){void 0!==a&&(this.dom.value=a|0);return this};UI.Integer.prototype.setRange=function(a,b){this.min=a;this.max=b;return this};UI.Break=function(){UI.Element.call(this);var a=document.createElement("br");a.className="Break";this.dom=a;return this};UI.Break.prototype=Object.create(UI.Element.prototype);UI.HorizontalRule=function(){UI.Element.call(this);var a=document.createElement("hr");a.className="HorizontalRule";this.dom=a;return this};
UI.HorizontalRule.prototype=Object.create(UI.Element.prototype);UI.Button=function(a){UI.Element.call(this);var b=document.createElement("button");b.className="Button";this.dom=b;this.dom.textContent=a;return this};UI.Button.prototype=Object.create(UI.Element.prototype);UI.Button.prototype.setLabel=function(a){this.dom.textContent=a;return this};
UI.MenubarHelper={createMenuContainer:function(a,b){var c=new UI.Panel,d=new UI.Panel;d.setClass("title");d.setTextContent(a);d.setMargin("0px");d.setPadding("8px");c.setClass("menu");c.add(d);c.add(b);return c},createOption:function(a,b,c){var d=new UI.Panel;d.setClass("option");c?(d.add((new UI.Icon(c)).setWidth("20px")),d.add(new UI.Text(a))):d.setTextContent(a);d.onClick(b);return d},createOptionsPanel:function(a){var b=new UI.Panel;b.setClass("options");a.forEach(function(a){b.add(a)});return b},
createInput:function(a,b){var c=(new UI.Panel).setClass("option"),d=(new UI.Text).setWidth("70px").setValue(a),e=(new UI.Input).setWidth("40px").onKeyDown(b);c.add(d);c.add(e);return c},createCheckbox:function(a,b,c){var d=(new UI.Panel).setClass("option");a=(new UI.Text).setWidth("70px").setValue(a);b=(new UI.Checkbox).setValue(b).onClick(c);d.add(b);d.add(a);return d},createDivider:function(){return new UI.HorizontalRule}};
UI.Html=function(a){UI.Element.call(this);var b=document.createElement("span");b.className="Html";b.style.cursor="default";b.style.display="inline-block";b.style.verticalAlign="middle";this.dom=b;this.setValue(a);return this};UI.Html.prototype=Object.create(UI.Element.prototype);UI.Html.prototype.setValue=function(a){void 0!==a&&(this.dom.innerHTML=a);return this};UI.OverlayPanel=function(){UI.Panel.call(this);this.dom.className="Panel OverlayPanel";return this};UI.OverlayPanel.prototype=Object.create(UI.Panel.prototype);
UI.OverlayPanel.prototype.attach=function(a){a=a||document.body;a.appendChild(this.dom);return this};UI.Icon=function(a){UI.Panel.call(this);var b=document.createElement("span");b.className="Icon fa";this.dom=b;a&&this.addClass.apply(this,arguments);return this};UI.Icon.prototype=Object.create(UI.Panel.prototype);UI.Icon.prototype.hasClass=function(a){return this.dom.classList.contains("fa-"+a)};
UI.Icon.prototype.addClass=function(a){for(var b=0;b<arguments.length;b++)this.dom.classList.add("fa-"+arguments[b]);return this};UI.Icon.prototype.setClass=function(a){this.dom.className="Icon fa";for(var b=0;b<arguments.length;b++)this.dom.classList.add("fa-"+arguments[b]);return this};UI.Icon.prototype.removeClass=function(a){for(var b=0;b<arguments.length;b++)this.dom.classList.remove("fa-"+arguments[b]);return this};
UI.Icon.prototype.switchClass=function(a,b){this.removeClass(b,a);this.addClass(a);return this};UI.ToggleIcon=function(a,b,c){UI.Icon.call(this,a?b:c);this.value=a;this.classTrue=b;this.classFalse=c;return this};UI.ToggleIcon.prototype=Object.create(UI.Icon.prototype);UI.ToggleIcon.prototype.setValue=function(a){(this.value=a)?this.switchClass(this.classTrue,this.classFalse):this.switchClass(this.classFalse,this.classTrue);return this};UI.ToggleIcon.prototype.getValue=function(){return this.value};
UI.DisposeIcon=function(){UI.Icon.call(this,"trash-o");var a=!1,b=this;this.setTitle("delete");this.onClick(function(){!0===a?"function"===typeof b.disposeFunction&&b.disposeFunction():(b.setColor("rgb(178, 34, 34)"),a=!0,setTimeout(function(){b.setColor("#888");a=!1},1E3))});return this};UI.DisposeIcon.prototype=Object.create(UI.Icon.prototype);UI.DisposeIcon.prototype.setDisposeFunction=function(a){this.disposeFunction=a;return this};
UI.Progress=function(a,b){UI.Element.call(this);var c=document.createElement("progress");c.className="Progress";c.max=a||1;void 0!==b&&(c.value=b);this.dom=c;return this};UI.Progress.prototype=Object.create(UI.Element.prototype);UI.Progress.prototype.getValue=function(){return this.dom.value};UI.Progress.prototype.setValue=function(a){this.dom.value=a;return this};UI.Progress.prototype.setMax=function(a){this.dom.max=a;return this};
UI.Progress.prototype.setIndeterminate=function(){this.dom.removeAttribute("value");return this};UI.Range=function(a,b,c,d){UI.Element.call(this);var e=document.createElement("input");e.className="Range";e.type="range";e.min=a;e.max=b;e.value=c;e.step=d;this.dom=e;this.dom.textContent=c;this.onInput(function(){this.dom.setAttribute("value",this.getValue())});return this};UI.Range.prototype=Object.create(UI.Element.prototype);UI.Range.prototype.getValue=function(){return this.dom.value};
UI.Range.prototype.setRange=function(a,b){this.dom.min=a;this.dom.max=b;return this};UI.Range.prototype.setValue=function(a){this.dom.value=a;return this};UI.Range.prototype.setStep=function(a){this.dom.step=a;return this};
UI.AdaptiveTextArea=function(){UI.Element.call(this);var a=document.createElement("div");a.className="AdaptiveTextAreaContainer";var b=document.createElement("textarea");b.className="AdaptiveTextArea";var c=document.createElement("div");c.className="AdaptiveTextAreaSize";a.appendChild(b);a.appendChild(c);b.addEventListener("input",function(a){c.innerHTML=b.value+"\n"},!1);this.textarea=b;this.size=c;this.dom=a;return this};UI.AdaptiveTextArea.prototype=Object.create(UI.Element.prototype);
UI.AdaptiveTextArea.prototype.getValue=function(){return this.textarea.value};UI.AdaptiveTextArea.prototype.setValue=function(a){this.textarea.value=a;this.size.innerHTML=a+"\n";return this};UI.AdaptiveTextArea.prototype.setSpellcheck=function(a){this.textarea.spellcheck=a;return this};UI.AdaptiveTextArea.prototype.setBackgroundColor=function(a){this.textarea.style.backgroundColor=a;return this};
UI.VirtualList=function(a){UI.Element.call(this);var b=document.createElement("div");b.className="VirtualList";this.dom=b;this._items=a;this.list=new VirtualList({w:280,h:300,itemHeight:31,totalRows:a.length,generatorFn:function(b){var d=new UI.Panel;b=(new UI.Text).setColor("orange").setMarginLeft("10px").setValue("ITEM "+a[b]);d.add(b);return d.dom}});console.log(this.dom);console.log(this.list);this.dom.appendChild(this.list.container);return this};
UI.PopupMenu=function(a,b){UI.Panel.call(this);var c=new UI.Icon(a||"bars"),d=(new UI.OverlayPanel).setDisplay("none").attach(this.dom),e=(new UI.Panel).setBorderBottom("1px solid #555").setMarginBottom("10px").setHeight("25px");e.add((new UI.Icon("times")).setFloat("right").onClick(function(){d.setDisplay("none")})).add(new UI.Text(b));d.add(e);c.setTitle("menu");c.onClick(function(a){"block"===d.getDisplay()?d.setDisplay("none"):(d.setDisplay("block"),(new Tether({element:d.dom,target:c.dom,attachment:"top right",
targetAttachment:"top left",offset:"0px 5px",constraints:[{to:"window",attachment:"element"}]})).position())});this.add(c);this.setClass("").setDisplay("inline");this.icon=c;this.panel=d;this.entryLabelWidth="100px";return this};UI.PopupMenu.prototype=Object.create(UI.Panel.prototype);UI.PopupMenu.prototype.addEntry=function(a,b){this.panel.add((new UI.Text(a)).setWidth(this.entryLabelWidth)).add(b||new UI.Panel).add(new UI.Break);return this};
UI.PopupMenu.prototype.setEntryLabelWidth=function(a){this.entryLabelWidth=a;return this};UI.PopupMenu.prototype.setMenuDisplay=function(a){this.panel.setDisplay(a);return this};UI.PopupMenu.prototype.dispose=function(){this.panel.dispose();UI.Element.prototype.dispose.call(this)};
UI.CollapsibleIconPanel=function(a,b){UI.Panel.call(this);this.dom.className="Panel CollapsiblePanel";void 0===a&&(a=a||"chevron-right",b=b||"chevron-down");this.button=(new UI.Icon(a)).setWidth("12px").setMarginRight("6px");this.addStatic(this.button);var c=this;this.button.dom.addEventListener("click",function(a){c.toggle()},!1);this.content=document.createElement("div");this.content.className="CollapsibleContent";this.dom.appendChild(this.content);this.isCollapsed=!1;this.iconClass1=a;this.iconClass2=
b;return this};UI.CollapsibleIconPanel.prototype=Object.create(UI.CollapsiblePanel.prototype);UI.CollapsibleIconPanel.prototype.setCollapsed=function(a){a?(this.dom.classList.add("collapsed"),this.iconClass2?this.button.switchClass(this.iconClass2,this.iconClass1):this.button.addClass("rotate-90")):(this.dom.classList.remove("collapsed"),this.iconClass2?this.button.switchClass(this.iconClass1,this.iconClass2):this.button.removeClass("rotate-90"));this.isCollapsed=a};
UI.ColorPicker=function(){var a=this;UI.Panel.call(this);this.slideWrapper=(new UI.Panel).setClass("slide-wrapper");this.sliderIndicator=(new UI.Panel).setClass("slide-indicator");this.slider=(new UI.Panel).setClass("slide").setWidth("25px").setHeight("80px");this.slideWrapper.add(this.slider,this.sliderIndicator);this.pickerWrapper=(new UI.Panel).setClass("picker-wrapper");this.pickerIndicator=(new UI.Panel).setClass("picker-indicator");this.picker=(new UI.Panel).setClass("picker").setWidth("130px").setHeight("80px");
this.pickerWrapper.add(this.picker,this.pickerIndicator);var b=document.createEvent("Event");b.initEvent("change",!0,!0);this.add(this.pickerWrapper,this.slideWrapper);ColorPicker.fixIndicators(this.sliderIndicator.dom,this.pickerIndicator.dom);this.colorPicker=ColorPicker(this.slider.dom,this.picker.dom,function(c,d,e,f,g){ColorPicker.positionIndicators(a.sliderIndicator.dom,a.pickerIndicator.dom,g,f);a.hex=c;a.hsv=d;a.rgb=e;a._settingValue||a.dom.dispatchEvent(b,c,d,e)});return this};
UI.ColorPicker.prototype=Object.create(UI.Panel.prototype);UI.ColorPicker.prototype.setValue=function(a){this._settingValue=!0;this.colorPicker.setHex(a);this._settingValue=!1;return this};UI.ColorPicker.prototype.getValue=function(){return this.hex};
UI.ColorPopupMenu=function(){var a=this;UI.Panel.call(this);this.iconText=(new UI.Text("")).setClass("fa-stack-1x").setColor("#111");this.iconSquare=new UI.Icon("square","stack-1x");this.menu=new UI.PopupMenu("stack","Color");this.menu.icon.setTitle("color").setWidth("1em").setHeight("1em").setLineHeight("1em").add(this.iconSquare).add(this.iconText);var b=document.createEvent("Event");b.initEvent("change",!0,!0);this.schemeSelector=(new UI.Select).setColor("#444").setWidth("").setOptions(NGL.ColorFactory.types).onChange(function(){a.setScheme(a.schemeSelector.getValue());
"color"!==a.schemeSelector.getValue()&&a.menu.setMenuDisplay("none");a.dom.dispatchEvent(b)});this.colorInput=(new UI.Input).onChange(function(){a.setColor(a.colorInput.getValue());a.dom.dispatchEvent(b)});this.colorPicker=(new UI.ColorPicker).setDisplay("inline-block").onChange(function(c,d,e,f){a.setColor(a.colorPicker.getValue());a.dom.dispatchEvent(b)});this.menu.addEntry("Scheme",this.schemeSelector).addEntry("Input",this.colorInput).addEntry("Picker",this.colorPicker);this.add(this.menu);this.setClass("").setDisplay("inline");
return this};UI.ColorPopupMenu.prototype=Object.create(UI.Panel.prototype);UI.ColorPopupMenu.prototype.setScheme=function(a){"color"!==a&&this.setColor("#888");this.iconText.setValue(a.charAt(0).toUpperCase());this.schemeSelector.setValue(a);return this};UI.ColorPopupMenu.prototype.getScheme=function(){return this.schemeSelector.getValue()};
UI.ColorPopupMenu.prototype.setColor=function(){var a=new THREE.Color;return function(b){this.setScheme("color");this.colorInput.setBackgroundColor(b).setValue(b);this.colorPicker.setValue(b);this.iconSquare.setColor(b);a.setStyle(b);1.5<a.r+a.g+a.b?this.iconText.setColor("#000"):this.iconText.setColor("#FFF");return this}}();UI.ColorPopupMenu.prototype.getColor=function(){return this.colorInput.getValue()};
UI.ColorPopupMenu.prototype.setValue=function(a){parseInt(a)===a?this.setColor("#"+(new THREE.Color(a)).getHexString()):this.setScheme(a);return this};UI.ColorPopupMenu.prototype.dispose=function(){this.menu.dispose();UI.Panel.prototype.dispose.call(this)};
UI.SelectionInput=function(a){UI.AdaptiveTextArea.call(this);this.setSpellcheck(!1);if(!(a instanceof NGL.Selection))return console.error("UI.SelectionInput: not a selection",a),this;this.setValue(a.string);this.selection=a;var b=this;a.signals.stringChanged.add(function(a){b.setValue(a)});this.onEnter();return this};UI.SelectionInput.prototype=Object.create(UI.AdaptiveTextArea.prototype);UI.SelectionInput.prototype.setValue=function(a){UI.AdaptiveTextArea.prototype.setValue.call(this,a);return this};
UI.SelectionInput.prototype.onEnter=function(a){var b=this;this.onKeyPress(function(c){var d=b.getValue(),e=String.fromCharCode(c.which);13===c.keyCode?(c.preventDefault(),(new NGL.Selection(d)).selection.error?b.setBackgroundColor("tomato"):("function"===typeof a?a(d):b.selection.setString(d),b.setBackgroundColor("white"))):b.selection.string!==d+e?b.setBackgroundColor("skyblue"):b.setBackgroundColor("white")});this.onKeyUp(function(a){a=b.getValue();(new NGL.Selection(a)).selection.error?b.setBackgroundColor("tomato"):
b.selection.string===b.getValue()?b.setBackgroundColor("white"):b.setBackgroundColor("skyblue")});return this};UI.SelectionPanel=function(a){UI.Panel.call(this);this.icon=(new UI.Icon("filter")).setTitle("filter selection").addClass("lg").setMarginRight("10px");this.input=new UI.SelectionInput(a);this.add(this.icon,this.input);return this};UI.SelectionPanel.prototype=Object.create(UI.Panel.prototype);UI.SelectionPanel.prototype.setInputWidth=function(a){this.input.setWidth(a);return this};
UI.ComponentPanel=function(a){UI.Panel.call(this);var b=a.stage,c=a.signals;c.nameChanged.add(function(a){d.setValue(NGL.unicodeHelper(a))});c.visibilityChanged.add(function(a){e.setValue(a)});c.disposed.add(function(){g.dispose()});var d=(new UI.Text(NGL.unicodeHelper(a.name))).setWidth("100px").setWordWrap("break-word"),e=(new UI.ToggleIcon(a.visible,"eye","eye-slash")).setTitle("hide/show").setMarginLeft("25px").onClick(function(){a.setVisibility(!a.visible)}),c=(new UI.Icon("bullseye")).setTitle("center").setMarginLeft("10px").onClick(function(){a.centerView(void 0,
!0)}),f=(new UI.DisposeIcon).setMarginLeft("10px").setDisposeFunction(function(){b.removeComponent(a)}),g=(new UI.PopupMenu("bars",a.type)).setMarginLeft("46px").setEntryLabelWidth("110px");this.add(d,e,c,f,g);this.menu=g;return this};UI.ComponentPanel.prototype=Object.create(UI.Panel.prototype);UI.ComponentPanel.prototype.addMenuEntry=function(a,b){this.menu.addEntry(a,b);return this};UI.ComponentPanel.prototype.setMenuDisplay=function(a){this.menu.setMenuDisplay(a);return this};NGL.Widget=function(){};
NGL.Widget.prototype={};
NGL.StageWidget=function(a){var b=a.signals,c=a.viewer;this.viewport=(new NGL.ViewportWidget(a)).setId("viewport");document.body.appendChild(this.viewport.dom);this.toolbar=(new NGL.ToolbarWidget(a)).setId("toolbar");document.body.appendChild(this.toolbar.dom);this.menubar=(new NGL.MenubarWidget(a)).setId("menubar");document.body.appendChild(this.menubar.dom);this.sidebar=(new NGL.SidebarWidget(a)).setId("sidebar");document.body.appendChild(this.sidebar.dom);b.requestTheme.add(function(a){a="light"===
a?"../css/light.css":"../css/dark.css";document.getElementById("theme").href=a});a.preferences.setTheme();c.onWindowResize();setTimeout(function(){c.onWindowResize()},500);return this};
NGL.ViewportWidget=function(a){var b=a.viewer,c=b.renderer,d=new UI.Panel;d.setPosition("absolute");b.container=d.dom;d.dom.appendChild(c.domElement);d.dom.addEventListener("dragover",function(a){a.stopPropagation();a.preventDefault();a.dataTransfer.dropEffect="copy"},!1);d.dom.addEventListener("drop",function(b){b.stopPropagation();b.preventDefault();b=b.dataTransfer.files;for(var c=b.length,d=0;d<c;++d)a.loadFile(b[d])},!1);return d};
NGL.ToolbarWidget=function(a){a=a.signals;var b=new UI.Panel,c=new UI.Panel;a.atomPicked.add(function(a){var b="none";a&&(b=a.qualifiedName()+" ("+a.residue.chain.model.structure.name+")");c.clear().add(new UI.Text("Picked: "+b))});b.add(c);return b};NGL.MenubarWidget=function(a){var b=new UI.Panel;b.add(new NGL.MenubarFileWidget(a));b.add(new NGL.MenubarViewWidget(a));b.add(new NGL.MenubarExamplesWidget(a));b.add(new NGL.MenubarHelpWidget(a));return b};
NGL.MenubarFileWidget=function(a){var b="pdb gro cif obj ply ngz gz lzma bz2 zip".split(" "),c=b+["ngl"],d=document.createElement("input");d.type="file";d.multiple=!0;d.style="visibility:hidden";d.accept="."+b.join(",.");d.addEventListener("change",function(b){b=b.target.files;for(var c=b.length,d=0;d<c;++d)a.loadFile(b[d],void 0,void 0,void 0,{asTrajectory:f,firstModelOnly:g,cAlphaOnly:h})},!1);var e=(new NGL.ExportImageWidget(a)).setDisplay("none").attach(),f=!1,g=!1,h=!1,b=UI.MenubarHelper.createOption,
l=UI.MenubarHelper.createInput,k=UI.MenubarHelper.createCheckbox,p=UI.MenubarHelper.createDivider,b=[b("Open...",function(){d.dispatchEvent(new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0}))}),b("Import...",function(){var b=new NGL.DirectoryListingWidget(a,"Import file",c,function(d){var e=d.path.split(".").pop().toLowerCase();-1!==c.indexOf(e)?a.loadFile(d.path,void 0,void 0,void 0,{asTrajectory:f,firstModelOnly:g,cAlphaOnly:h}):console.log("unknown filetype: "+e);b.dispose()});b.setOpacity("0.8").setLeft("50px").setTop("80px").attach()}),
l("PDB",function(b){13===b.keyCode&&(a.loadFile(b.target.value,void 0,void 0,void 0,{asTrajectory:f,firstModelOnly:g,cAlphaOnly:h}),b.target.value="")}),k("asTrajectory",!1,function(a){f=a.target.checked}),k("firstModelOnly",!1,function(a){g=a.target.checked}),k("cAlphaOnly",!1,function(a){h=a.target.checked}),p(),b("Screenshot",function(){a.viewer.screenshot(1,"image/png",1,!0,!1,!1)},"camera"),b("Export image...",function(){e.setOpacity("0.8").setLeft("50px").setTop("80px").setDisplay("block")})],
b=UI.MenubarHelper.createOptionsPanel(b);return UI.MenubarHelper.createMenuContainer("File",b)};
NGL.MenubarViewWidget=function(a){var b=UI.MenubarHelper.createOption,c=UI.MenubarHelper.createDivider,b=[b("Light theme",function(){document.getElementById("theme").href="../css/light.css";a.viewer.setBackground("white")}),b("Dark theme",function(){document.getElementById("theme").href="../css/dark.css";a.viewer.setBackground("black")}),c(),b("Full screen",function(){var a=document.body;a.requestFullscreen?a.requestFullscreen():a.msRequestFullscreen?a.msRequestFullscreen():a.mozRequestFullScreen?
a.mozRequestFullScreen():a.webkitRequestFullscreen&&a.webkitRequestFullscreen()},"expand"),b("Center",function(){a.centerView()},"bullseye"),c(),b("Orientation",function(){window.prompt("Orientation",JSON.stringify(a.viewer.getOrientation()))})],b=UI.MenubarHelper.createOptionsPanel(b);return UI.MenubarHelper.createMenuContainer("View",b)};
NGL.MenubarExamplesWidget=function(a){var b=UI.MenubarHelper.createOption,c=UI.MenubarHelper.createDivider,d=[];Object.keys(NGL.Examples.data).forEach(function(e){"__divider__"===e?d.push(c()):"_"!==e.charAt(0)&&d.push(b(e,function(){NGL.Examples.load(e,a)}))});var e=UI.MenubarHelper.createOptionsPanel(d);return UI.MenubarHelper.createMenuContainer("Examples",e)};
NGL.MenubarHelpWidget=function(a){var b=(new NGL.PreferencesWidget(a)).setDisplay("none").attach();a=UI.MenubarHelper.createOption;var c=UI.MenubarHelper.createDivider;a=[a("Documentation",function(){window.open("../doc/index.html","_blank")}),c(),a("Unittests",function(){window.open("../test/unit/unittests.html","_blank")}),a("Benchmarks",function(){window.open("../test/bench/benchmarks.html","_blank")}),c(),a("Prefereces",function(){b.setOpacity("0.8").setLeft("50px").setTop("80px").setDisplay("block")},
"sliders")];a=UI.MenubarHelper.createOptionsPanel(a);return UI.MenubarHelper.createMenuContainer("Help",a)};
NGL.PreferencesWidget=function(a){function b(a,b){e.add((new UI.Text(a)).setWidth("80px")).add(b||new UI.Panel).add(new UI.Break)}var c=a.preferences,d=new UI.OverlayPanel;a=(new UI.Panel).setBorderBottom("1px solid #555").setHeight("25px");var e=(new UI.Panel).setMarginTop("10px").setMinHeight("100px").setMaxHeight("500px").setOverflow("auto");a.add(new UI.Text("Preferences"));a.add((new UI.Icon("times")).setMarginLeft("20px").setFloat("right").onClick(function(){d.setDisplay("none")}));d.add(a);
d.add(e);var f=(new UI.Select).setOptions({dark:"dark",light:"light"}).setValue(c.getKey("theme")).onChange(function(){c.setTheme(f.getValue())}),g=(new UI.Select).setOptions({low:"low",medium:"medium",high:"high"}).setValue(c.getKey("quality")).onChange(function(){c.setQuality(g.getValue())}),h=(new UI.Checkbox).setValue(c.getKey("impostor")).onChange(function(){c.setImpostor(h.getValue())});b("theme",f);b("quality",g);b("impostor",h);return d};
NGL.ExportImageWidget=function(a){function b(a,b){f.add((new UI.Text(a)).setWidth("80px")).add(b||new UI.Panel).add(new UI.Break)}function c(b,c,d,e,f,g){var l=[];a.eachRepresentation(function(a){l.push(a.getParameters());var b=a.getParameters();void 0!==b.subdiv&&(b.subdiv=Math.max(25,b.subdiv));void 0!==b.radialSegments&&(b.radialSegments=Math.max(25,b.radialSegments));b.quality=null;a.rebuild(b)},NGL.StructureComponent);a.viewer.screenshot(b,c,d,e,f,g,function(b,c,d){1===b&&m.setMax(c);b===c||
b+1===c?m.setIndeterminate():m.setValue(b);if(d){m.setDisplay("none");q.setDisplay("inline-block");var e=0;a.eachRepresentation(function(a){a.rebuild(l[e]);e+=1},NGL.StructureComponent)}})}var d=new UI.OverlayPanel,e=(new UI.Panel).setBorderBottom("1px solid #555").setHeight("25px"),f=(new UI.Panel).setMarginTop("10px").setMinHeight("100px").setMaxHeight("500px").setOverflow("auto");e.add(new UI.Text("Image export"));e.add((new UI.Icon("times")).setMarginLeft("20px").setFloat("right").onClick(function(){d.setDisplay("none")}));
d.add(e);d.add(f);var g=(new UI.Select).setOptions({1:"1x",2:"2x",3:"3x",4:"4x",5:"5x",6:"6x",7:"7x",8:"8x",9:"9x",10:"10x"}).setValue("4"),h=(new UI.Select).setOptions({"image/png":"PNG","image/jpeg":"JPEG"}).setValue("image/png"),l=(new UI.Select).setOptions({"0.1":"0.1","0.2":"0.2","0.3":"0.3","0.4":"0.4","0.5":"0.5","0.6":"0.6","0.7":"0.7","0.8":"0.8","0.9":"0.9","1.0":"1.0"}).setValue("1.0"),k=(new UI.Checkbox).setValue(!0),p=(new UI.Checkbox).setValue(!1),n=(new UI.Checkbox).setValue(!1),m=
(new UI.Progress).setDisplay("none"),q=(new UI.Button("export")).onClick(function(){q.setDisplay("none");m.setDisplay("inline-block");setTimeout(function(){c(parseInt(g.getValue()),h.getValue(),parseFloat(l.getValue()),k.getValue(),p.getValue(),n.getValue())},50)});b("scale",g);b("type",h);b("quality",l);b("antialias",k);b("transparent",p);b("trim",n);f.add(new UI.Break,q,m);return d};
NGL.SidebarWidget=function(a){var b=a.signals,c=new UI.Panel,d=(new UI.Panel).setClass("Content"),e=[],f=[];b.componentAdded.add(function(b){var c;if(b instanceof NGL.StructureComponent)c=new NGL.StructureComponentWidget(b,a);else if(b instanceof NGL.SurfaceComponent)c=new NGL.SurfaceComponentWidget(b,a);else if(b instanceof NGL.ScriptComponent)c=new NGL.ScriptComponentWidget(b,a);else if(b instanceof NGL.Component)c=new NGL.ComponentWidget(b,a);else{console.warn("NGL.SidebarWidget: component type unknown",
b);return}d.add(c);e.push(b);f.push(c)});b.componentRemoved.add(function(a){a=e.indexOf(a);-1!==a&&(f[a].dispose(),e.splice(a,1),f.splice(a,1))});var b=(new UI.Icon("plus-square")).onClick(function(){f.forEach(function(a){a.expand()})}),g=(new UI.Icon("minus-square")).setMarginLeft("10px").onClick(function(){f.forEach(function(a){a.collapse()})}),h=(new UI.Icon("bullseye")).setMarginLeft("10px").onClick(function(){a.centerView()}),l=(new UI.PopupMenu("cogs","Settings")).setMarginLeft("10px"),k=(new UI.Range(1,
100,a.viewer.params.clipNear,1)).onInput(function(){a.viewer.setClip(k.getValue(),p.getValue())}),p=(new UI.Range(1,100,a.viewer.params.clipFar,1)).onInput(function(){a.viewer.setClip(k.getValue(),p.getValue())}),n=(new UI.Range(1,100,a.viewer.params.clipDist,1)).onInput(function(){a.viewer.params.clipDist=n.getValue();a.viewer.requestRender()}),m=(new UI.Range(1,100,a.viewer.params.fogNear,1)).onInput(function(){a.viewer.setFog(null,null,m.getValue(),q.getValue())}),q=(new UI.Range(1,100,a.viewer.params.fogFar,
1)).onInput(function(){a.viewer.setFog(null,null,m.getValue(),q.getValue())});l.addEntry("clip near",k).addEntry("clip far",p).addEntry("clip distance",n).addEntry("fog near",m).addEntry("fog far",q);b=(new UI.Panel).setClass("Panel Sticky").add(b,g,h,l);c.add(b,d);return c};
NGL.ComponentWidget=function(a,b){var c=a.signals,d=new UI.CollapsibleIconPanel("file");c.requestGuiVisibility.add(function(a){d.setCollapsed(!a)});c.statusChanged.add(function(b){b={404:"Error: file not found"}[a.status]||a.status;d.setCollapsed(!1);d.add((new UI.Text(b)).setMarginLeft("20px").setWidth("200px").setWordWrap("break-word"));d.removeStatic(e);d.addStatic(f)});var c=(new UI.Text(NGL.unicodeHelper(a.name))).setWidth("100px").setWordWrap("break-word"),e=(new UI.Panel).setDisplay("inline").add((new UI.Icon("spinner")).addClass("spin").setMarginLeft("25px")),
f=(new UI.DisposeIcon).setMarginLeft("10px").setDisposeFunction(function(){b.removeComponent(a)});d.addStatic(c,e);return d};
NGL.StructureComponentWidget=function(a,b){function c(){var c={"":"[ structure ]"};b.eachComponent(function(b,d){b!==a&&(c[d]=NGL.unicodeHelper(b.name))},NGL.StructureComponent);k.setOptions(c)}var d=a.signals,e=new UI.CollapsibleIconPanel("file"),f=new UI.Panel,g=new UI.Panel;d.requestGuiVisibility.add(function(a){e.setCollapsed(!a)});d.representationAdded.add(function(a){f.add(new NGL.RepresentationComponentWidget(a,b))});d.trajectoryAdded.add(function(a){g.add(new NGL.TrajectoryComponentWidget(a,
b))});e.add((new UI.SelectionPanel(a.selection)).setMarginLeft("20px").setInputWidth("214px"));var d=(new UI.Button("export")).onClick(function(){var b=new Blob([a.structure.toPdb()],{type:"text/plain"});NGL.download(b,"structure.pdb");n.setMenuDisplay("none")}),h=(new UI.Select).setColor("#444").setOptions(function(){var a={"":"[ add ]"},b;for(b in NGL.representationTypes)a[b]=b;return a}()).onChange(function(){a.addRepresentation(h.getValue());h.setValue("");n.setMenuDisplay("none")}),l=(new UI.Button("import")).onClick(function(){n.setMenuDisplay("none");
var c=["xtc","trr","dcd","netcdf","nc"],d=new NGL.DirectoryListingWidget(b,"Import trajectory",c,function(b){var e=b.path.split(".").pop().toLowerCase();-1!==c.indexOf(e)?(console.log(b),a.addTrajectory(b.path),d.dispose()):console.log("unknown trajectory type: "+e)});d.setOpacity("0.8").setLeft("50px").setTop("80px").attach()});b.signals.componentAdded.add(c);b.signals.componentRemoved.add(c);var k=(new UI.Select).setColor("#444").onChange(function(){a.superpose(b.compList[k.getValue()],!0);a.centerView();
k.setValue("");n.setMenuDisplay("none")});c();var p=(new UI.Button("calculate")).onClick(function(){a.structure.autoSS();a.rebuildRepresentations();n.setMenuDisplay("none")}),n=(new UI.ComponentPanel(a)).setDisplay("inline-block").setMargin("0px").addMenuEntry("PDB file",d).addMenuEntry("Representation",h).addMenuEntry("Trajectory",l).addMenuEntry("Superpose",k).addMenuEntry("SS",p).addMenuEntry("File",(new UI.Text(a.structure.path)).setMaxWidth("100px").setWordWrap("break-word"));e.addStatic(n).add(g).add(f);
return e};
NGL.SurfaceComponentWidget=function(a,b){var c=a.signals,d=new UI.CollapsibleIconPanel("file"),e=new UI.Panel;c.requestGuiVisibility.add(function(a){d.setCollapsed(!a)});c.representationAdded.add(function(a){e.add(new NGL.RepresentationComponentWidget(a,b))});var c=(new UI.Button("add")).onClick(function(){a.addRepresentation();f.setMenuDisplay("none")}),f=(new UI.ComponentPanel(a)).setDisplay("inline-block").setMargin("0px").addMenuEntry("Representation",c).addMenuEntry("File",(new UI.Text(a.surface.path)).setMaxWidth("100px").setWordWrap("break-word"));d.addStatic(f).add(e);
return d};
NGL.ScriptComponentWidget=function(a,b){var c=a.signals,d=new UI.CollapsibleIconPanel("file"),e=(new UI.Panel).setMarginLeft("20px");c.requestGuiVisibility.add(function(a){d.setCollapsed(!a)});c.nameChanged.add(function(a){g.setValue(NGL.unicodeHelper(a))});c.statusChanged.add(function(a){"finished"===a&&(d.removeStatic(h),d.addStatic(f))});a.script.signals.elementAdded.add(function(a){e.add.apply(e,a)});var f=(new UI.DisposeIcon).setMarginLeft("10px").setDisposeFunction(function(){b.removeComponent(a)}),g=
(new UI.Text(NGL.unicodeHelper(a.name))).setWidth("100px").setWordWrap("break-word"),h=(new UI.Icon("spinner")).addClass("spin").setMarginLeft("25px");d.addStatic(g).addStatic(h);d.add(e);return d};
NGL.RepresentationComponentWidget=function(a,b){var c=a.signals,d=(new UI.CollapsibleIconPanel("bookmark")).setMarginLeft("20px");c.visibilityChanged.add(function(a){e.setValue(a)});c.colorChanged.add(function(a){g.setValue(a)});c.disposed.add(function(){h.dispose();g.dispose();d.dispose()});var e=(new UI.ToggleIcon(a.visible,"eye","eye-slash")).setTitle("hide/show").setMarginLeft("25px").onClick(function(){a.setVisibility(!a.visible)}),f=(new UI.DisposeIcon).setMarginLeft("10px").setDisposeFunction(function(){a.dispose()}),
g=(new UI.ColorPopupMenu).setMarginLeft("10px").setValue(a.repr.color).onChange(function(){var b=new THREE.Color;return function(c){c=g.getScheme();"color"===c?(b.setStyle(g.getColor()),a.setColor(b.getHex())):a.setColor(c);a.viewer.requestRender()}}());d.addStatic((new UI.Text(a.repr.type)).setWidth("80px")).addStatic(e).addStatic(f).addStatic(g);(a.parent instanceof NGL.StructureComponent||a.parent instanceof NGL.TrajectoryComponent)&&d.add((new UI.SelectionPanel(a.repr.selection)).setMarginLeft("20px").setInputWidth("194px"));
var h=(new UI.PopupMenu("bars","Representation")).setMarginLeft("45px").setEntryLabelWidth("110px");Object.keys(a.repr.parameters).forEach(function(b){var d=a.repr,e,f=d.parameters[b];f&&("number"===f.type||"integer"===f.type?(e="number"===f.type?(new UI.Number(parseFloat(d[b])||NaN)).setPrecision(f.precision):new UI.Integer(parseInt(d[b])||NaN),e.setRange(f.min,f.max)):"boolean"===f.type?e=new UI.Checkbox(d[b]):"select"===f.type?e=(new UI.Select).setWidth("").setOptions(f.options).setValue(d[b]):
"button"===f.type&&(e=(new UI.Button(b)).onClick(function(){d[b]()})),e&&(c.parametersChanged.add(function(a){e.setValue(d[b])}),e.onChange(function(){var a={};a[b]=e.getValue();d.setParameters(a);d.viewer.render()}),h.addEntry(b,e)))});d.addStatic(h);return d};
NGL.TrajectoryComponentWidget=function(a,b){function c(a){h.clear().add(k.setWidth("70px"));k.setRange(-1,a-1);n.setRange(-1,a-1);p.setValue(Math.ceil((a+1)/100));q.step=p.getValue();q.end=a}var d=a.signals,e=a.trajectory,f=(new UI.CollapsibleIconPanel("database")).setMarginLeft("20px"),g=new UI.Panel;d.representationAdded.add(function(a){g.add(new NGL.RepresentationComponentWidget(a,b))});var h=(new UI.Panel).setMarginLeft("10px").setDisplay("inline").add((new UI.Icon("spinner")).addClass("spin").setMarginRight("69px"));
d.gotNumframes.add(c);d.frameChanged.add(function(a){k.setValue(a);n.setValue(a);h.clear().add(k.setWidth("70px"))});var l=(new UI.Text(e.name)).setWidth("108px").setWordWrap("break-word");f.addStatic(l);f.addStatic(h);var k=(new UI.Integer(-1)).setMarginLeft("5px").setWidth("70px").setRange(-1,-1).onChange(function(a){e.setFrame(k.getValue());r.setMenuDisplay("none")}),p=(new UI.Integer(1)).setWidth("30px").setRange(1,1E4).onChange(function(){q.step=p.getValue()}),l=new UI.Panel,n=(new UI.Range(-1,
-1,-1,1)).setWidth("197px").setMargin("0px").setPadding("0px").setBorder("0px").onInput(function(a){a=n.getValue();a!==e.currentFrame&&(e.player&&e.player._running?(e.setPlayer(),e.setFrame(a)):e.inProgress||e.setFrame(a))}),m=(new UI.Integer(50)).setWidth("30px").setRange(10,1E3).onChange(function(){q.timeout=m.getValue()}),q=new NGL.TrajectoryPlayer(e,p.getValue(),m.getValue(),0,e.numframes),s=(new UI.ToggleIcon(!0,"play","pause")).setMarginRight("10px").setMarginLeft("20px").setWidth("12px").setTitle("play").onClick(function(){q.toggle()});
q.signals.startedRunning.add(function(){s.setTitle("pause").setValue(!1)});q.signals.haltedRunning.add(function(){s.setTitle("play").setValue(!0)});l.add(s);l.add(n);f.add((new UI.SelectionPanel(e.selection)).setMarginLeft("20px").setInputWidth("194px"));var t=(new UI.Checkbox(e.params.centerPbc)).onChange(function(){a.setParameters({centerPbc:t.getValue()});r.setMenuDisplay("none")}),u=(new UI.Checkbox(e.params.removePbc)).onChange(function(){a.setParameters({removePbc:u.getValue()});r.setMenuDisplay("none")}),
v=(new UI.Checkbox(e.params.superpose)).onChange(function(){a.setParameters({superpose:v.getValue()});r.setMenuDisplay("none")});d.parametersChanged.add(function(a){t.setValue(a.centerPbc);u.setValue(a.removePbc);v.setValue(a.superpose)});(new UI.Button("download")).onClick(function(){e.download(p.getValue())});d=(new UI.Button("add")).onClick(function(){a.addRepresentation();r.setMenuDisplay("none")});e.numframes&&c(e.numframes);var r=(new UI.PopupMenu("bars","Trajectory")).setMarginLeft("10px").setEntryLabelWidth("110px").addEntry("Path",
d).addEntry("Center",t).addEntry("Remove PBC",u).addEntry("Superpose",v).addEntry("Step",p).addEntry("Timeout",m).addEntry("File",(new UI.Text(e.trajPath)).setMaxWidth("100px").setWordWrap("break-word"));f.addStatic(r);f.add(l);f.add(g);return f};NGL.lastUsedDirectory="";NGL.DirectoryListing=function(){this.signals={listingLoaded:new signals.Signal}};
NGL.DirectoryListing.prototype={getListing:function(a){var b=this;a=a||"";(new THREE.XHRLoader).load("../dir/"+a,function(c){c=JSON.parse(c);b.signals.listingLoaded.dispatch(a,c)})},getFolderDict:function(a){var b={"":""},c=[];(a||"").split("/").forEach(function(a){c.push(a);b[c.join("/")]=a});return b}};
NGL.DirectoryListingWidget=function(a,b,c,d){function e(a,b,c,d,e){return(b=Math,c=b.log,d=1E3,e=c(a)/c(d)|0,a/b.pow(d,e)).toFixed(2)+String.fromCharCode(160)+(e?"kMGTPEZY"[--e]+"B":"Bytes")}var f=new NGL.DirectoryListing;f.getListing(NGL.lastUsedDirectory);a=f.signals;var g=new UI.OverlayPanel,h=(new UI.Panel).setBorderBottom("1px solid #555").setHeight("30px"),l=(new UI.Panel).setMarginTop("10px").setMinHeight("100px").setMaxHeight("500px").setOverflow("auto"),k=(new UI.Select).setColor("#444").setMarginLeft("20px").setWidth("").setMaxWidth("200px").setOptions(f.getFolderDict()).onChange(function(){f.getListing(k.getValue())});
h.add(new UI.Text(b||"Directoy listing"));h.add(k);h.add((new UI.Icon("times")).setMarginLeft("20px").setFloat("right").onClick(function(){g.dispose()}));g.add(h);g.add(l);a.listingLoaded.add(function(a,b){NGL.lastUsedDirectory=a;l.clear();k.setOptions(f.getFolderDict(a)).setValue(a);b.forEach(function(a){var b=a.path.split(".").pop().toLowerCase();if(!c||a.dir||-1!==c.indexOf(b)){var g;a.dir?(b="folder-o",g=a.name):(b="file-o",g=a.name+String.fromCharCode(160)+"("+e(a.size)+")");b=(new UI.Panel).setDisplay("block").add((new UI.Icon(b)).setWidth("20px")).add(new UI.Text(g)).onClick(function(){a.dir?
f.getListing(a.path):d(a)});a.restricted&&b.add((new UI.Icon("lock")).setMarginLeft("5px"));l.add(b)}})});return g};

