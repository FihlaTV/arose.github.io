<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../">
  <title data-ice="title">src/viewer/viewer.js | NGL Viewer API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header><span>NGL@0.10.3-0</span>
  <a href="./">Home</a>
  <a href="./manual/index.html" data-ice="manualHeaderLink">Manual</a>
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <a href="./../gallery/index.html">Gallery</a><a data-ice="repoURL" href="https://github.com/arose/ngl.git" class="repo-url-github">Repository</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/script.js~Script.html">Script</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/selection.js~Selection.html">Selection</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-binarySearchIndexOf">binarySearchIndexOf</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-Browser">Browser</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-ColormakerRegistry">ColormakerRegistry</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-ExtensionFragDepth">ExtensionFragDepth</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-Mobile">Mobile</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-Version">Version</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-external">E</span><span data-ice="name"><span><a href="https://threejs.org/docs/#api/math/Box3">Box3</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-external">E</span><span data-ice="name"><span><a href="https://threejs.org/docs/#api/core/BufferGeometry">BufferGeometry</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-external">E</span><span data-ice="name"><span><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String">Char</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-external">E</span><span data-ice="name"><span><a href="https://threejs.org/docs/#api/math/Color">Color</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-external">E</span><span data-ice="name"><span><a href="https://threejs.org/docs/#api/math/Euler">Euler</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-external">E</span><span data-ice="name"><span><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number">Float</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-external">E</span><span data-ice="name"><span><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number">Integer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-external">E</span><span data-ice="name"><span><a href="https://threejs.org/docs/#api/math/Matrix3">Matrix3</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-external">E</span><span data-ice="name"><span><a href="https://threejs.org/docs/#api/math/Matrix4">Matrix4</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-external">E</span><span data-ice="name"><span><a href="https://threejs.org/docs/#api/math/Plane">Plane</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-external">E</span><span data-ice="name"><span><a href="https://threejs.org/docs/#api/math/Quaternion">Quaternion</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-external">E</span><span data-ice="name"><span><a href="https://millermedeiros.github.io/js-signals/docs/symbols/Signal.html">Signal</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-external">E</span><span data-ice="name"><span><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/TypedArray">TypedArray</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-external">E</span><span data-ice="name"><span><a href="https://threejs.org/docs/#api/math/Vector2">Vector2</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-external">E</span><span data-ice="name"><span><a href="https://threejs.org/docs/#api/math/Vector3">Vector3</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">align</div><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-superpose">superpose</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">animation</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/animation/animation.js~AnimationList.html">AnimationList</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/animation/animation.js~MoveAnimation.html">MoveAnimation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/animation/animation.js~RockAnimation.html">RockAnimation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/animation/animation.js~RotateAnimation.html">RotateAnimation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/animation/animation.js~SpinAnimation.html">SpinAnimation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/animation/animation.js~ValueAnimation.html">ValueAnimation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/animation/animation.js~ZoomAnimation.html">ZoomAnimation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-interface">I</span><span data-ice="name"><span><a href="class/src/animation/animation.js~Animation.html">Animation</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">buffer</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/buffer/arrow-buffer.js~ArrowBuffer.html">ArrowBuffer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/buffer/cone-buffer.js~ConeBuffer.html">ConeBuffer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/buffer/conegeometry-buffer.js~ConeGeometryBuffer.html">ConeGeometryBuffer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/buffer/contour-buffer.js~ContourBuffer.html">ContourBuffer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/buffer/cylinder-buffer.js~CylinderBuffer.html">CylinderBuffer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/buffer/cylindergeometry-buffer.js~CylinderGeometryBuffer.html">CylinderGeometryBuffer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/buffer/cylinderimpostor-buffer.js~CylinderImpostorBuffer.html">CylinderImpostorBuffer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/buffer/doublesided-buffer.js~DoubleSidedBuffer.html">DoubleSidedBuffer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/buffer/ellipsoid-buffer.js~EllipsoidBuffer.html">EllipsoidBuffer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/buffer/ellipsoidgeometry-buffer.js~EllipsoidGeometryBuffer.html">EllipsoidGeometryBuffer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/buffer/hyperballstick-buffer.js~HyperballStickBuffer.html">HyperballStickBuffer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/buffer/hyperballstickimpostor-buffer.js~HyperballStickImpostorBuffer.html">HyperballStickImpostorBuffer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/buffer/image-buffer.js~ImageBuffer.html">ImageBuffer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/buffer/line-buffer.js~LineBuffer.html">LineBuffer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/buffer/mesh-buffer.js~MeshBuffer.html">MeshBuffer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/buffer/point-buffer.js~PointBuffer.html">PointBuffer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/buffer/ribbon-buffer.js~RibbonBuffer.html">RibbonBuffer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/buffer/sphere-buffer.js~SphereBuffer.html">SphereBuffer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/buffer/spheregeometry-buffer.js~SphereGeometryBuffer.html">SphereGeometryBuffer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/buffer/sphereimpostor-buffer.js~SphereImpostorBuffer.html">SphereImpostorBuffer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/buffer/surface-buffer.js~SurfaceBuffer.html">SurfaceBuffer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/buffer/text-buffer.js~TextBuffer.html">TextBuffer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/buffer/trace-buffer.js~TraceBuffer.html">TraceBuffer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/buffer/tubemesh-buffer.js~TubeMeshBuffer.html">TubeMeshBuffer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/buffer/vector-buffer.js~VectorBuffer.html">VectorBuffer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-interface">I</span><span data-ice="name"><span><a href="class/src/buffer/alignedbox-buffer.js~AlignedBoxBuffer.html">AlignedBoxBuffer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-interface">I</span><span data-ice="name"><span><a href="class/src/buffer/box-buffer.js~BoxBuffer.html">BoxBuffer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-interface">I</span><span data-ice="name"><span><a href="class/src/buffer/buffer.js~Buffer.html">Buffer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-interface">I</span><span data-ice="name"><span><a href="class/src/buffer/geometry-buffer.js~GeometryBuffer.html">GeometryBuffer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-interface">I</span><span data-ice="name"><span><a href="class/src/buffer/mapped-buffer.js~MappedBuffer.html">MappedBuffer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-interface">I</span><span data-ice="name"><span><a href="class/src/buffer/quad-buffer.js~QuadBuffer.html">QuadBuffer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-BufferParameters">BufferParameters</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-TextBufferParameters">TextBufferParameters</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">color</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/color/atomindex-colormaker.js~AtomindexColormaker.html">AtomindexColormaker</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/color/bfactor-colormaker.js~BfactorColormaker.html">BfactorColormaker</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/color/chainid-colormaker.js~ChainidColormaker.html">ChainidColormaker</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/color/chainindex-colormaker.js~ChainindexColormaker.html">ChainindexColormaker</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/color/chainname-colormaker.js~ChainnameColormaker.html">ChainnameColormaker</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/color/colormaker-registry.js~ColormakerRegistry.html">ColormakerRegistry</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/color/densityfit-colormaker.js~DensityfitColormaker.html">DensityfitColormaker</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/color/electrostatic-colormaker.js~ElectrostaticColormaker.html">ElectrostaticColormaker</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/color/element-colormaker.js~ElementColormaker.html">ElementColormaker</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/color/entityindex-colormaker.js~EntityindexColormaker.html">EntityindexColormaker</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/color/entitytype-colormaker.js~EntitytypeColormaker.html">EntitytypeColormaker</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/color/geoquality-colormaker.js~GeoqualityColormaker.html">GeoqualityColormaker</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/color/hydrophobicity-colormaker.js~HydrophobicityColormaker.html">HydrophobicityColormaker</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/color/modelindex-colormaker.js~ModelindexColormaker.html">ModelindexColormaker</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/color/moleculetype-colormaker.js~MoleculetypeColormaker.html">MoleculetypeColormaker</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/color/occupancy-colormaker.js~OccupancyColormaker.html">OccupancyColormaker</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/color/random-colormaker.js~RandomColormaker.html">RandomColormaker</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/color/residueindex-colormaker.js~ResidueindexColormaker.html">ResidueindexColormaker</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/color/resname-colormaker.js~ResnameColormaker.html">ResnameColormaker</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/color/selection-colormaker.js~SelectionColormaker.html">SelectionColormaker</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/color/sstruc-colormaker.js~SstrucColormaker.html">SstrucColormaker</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/color/uniform-colormaker.js~UniformColormaker.html">UniformColormaker</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/color/value-colormaker.js~ValueColormaker.html">ValueColormaker</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/color/volume-colormaker.js~VolumeColormaker.html">VolumeColormaker</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-interface">I</span><span data-ice="name"><span><a href="class/src/color/colormaker.js~Colormaker.html">Colormaker</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-ColormakerParameters">ColormakerParameters</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">component</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/component/annotation.js~Annotation.html">Annotation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/component/representation-component.js~RepresentationComponent.html">RepresentationComponent</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/component/script-component.js~ScriptComponent.html">ScriptComponent</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/component/shape-component.js~ShapeComponent.html">ShapeComponent</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/component/structure-component.js~StructureComponent.html">StructureComponent</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/component/surface-component.js~SurfaceComponent.html">SurfaceComponent</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/component/trajectory-component.js~TrajectoryComponent.html">TrajectoryComponent</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/component/volume-component.js~VolumeComponent.html">VolumeComponent</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-interface">I</span><span data-ice="name"><span><a href="class/src/component/component.js~Component.html">Component</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-ComponentParameters">ComponentParameters</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-ComponentSignals">ComponentSignals</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-RepresentationComponentSignals">RepresentationComponentSignals</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-StructureComponentSignals">StructureComponentSignals</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-TrajectoryComponentParameters">TrajectoryComponentParameters</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-TrajectoryComponentSignals">TrajectoryComponentSignals</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">controls</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/controls/animation-controls.js~AnimationControls.html">AnimationControls</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/controls/component-controls.js~ComponentControls.html">ComponentControls</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/controls/mouse-actions.js~MouseActions.html">MouseActions</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/controls/mouse-controls.js~MouseControls.html">MouseControls</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/controls/picking-controls.js~PickingControls.html">PickingControls</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/controls/picking-proxy.js~PickingProxy.html">PickingProxy</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/controls/trackball-controls.js~TrackballControls.html">TrackballControls</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/controls/viewer-controls.js~ViewerControls.html">ViewerControls</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-TriggerString">TriggerString</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-PickingData">PickingData</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-OrientationMatrix">OrientationMatrix</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">geometry</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/geometry/shape.js~Shape.html">Shape</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">loader</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/loader/loader.js~Loader.html">Loader</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/loader/parser-loader.js~ParserLoader.html">ParserLoader</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/loader/plugin-loader.js~PluginLoader.html">PluginLoader</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/loader/script-loader.js~ScriptLoader.html">ScriptLoader</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-autoLoad">autoLoad</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-LoaderParameters">LoaderParameters</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">math</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/math/principal-axes.js~PrincipalAxes.html">PrincipalAxes</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-quicksortIP">quicksortIP</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-lineLineIntersect">lineLineIntersect</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">parser</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/parser/csv-parser.js~CsvParser.html">CsvParser</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">proxy</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/proxy/atom-proxy.js~AtomProxy.html">AtomProxy</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/proxy/bond-proxy.js~BondProxy.html">BondProxy</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/proxy/chain-proxy.js~ChainProxy.html">ChainProxy</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/proxy/model-proxy.js~ModelProxy.html">ModelProxy</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/proxy/polymer.js~Polymer.html">Polymer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/proxy/residue-proxy.js~ResidueProxy.html">ResidueProxy</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">representation</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/representation/axes-representation.js~AxesRepresentation.html">AxesRepresentation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/representation/backbone-representation.js~BackboneRepresentation.html">BackboneRepresentation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/representation/ballandstick-representation.js~BallAndStickRepresentation.html">BallAndStickRepresentation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/representation/base-representation.js~BaseRepresentation.html">BaseRepresentation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/representation/buffer-representation.js~BufferRepresentation.html">BufferRepresentation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/representation/cartoon-representation.js~CartoonRepresentation.html">CartoonRepresentation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/representation/distance-representation.js~DistanceRepresentation.html">DistanceRepresentation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/representation/label-representation.js~LabelRepresentation.html">LabelRepresentation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/representation/licorice-representation.js~LicoriceRepresentation.html">LicoriceRepresentation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/representation/line-representation.js~LineRepresentation.html">LineRepresentation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/representation/representation.js~Representation.html">Representation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/representation/structure-representation.js~StructureRepresentation.html">StructureRepresentation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/representation/surface-representation.js~SurfaceRepresentation.html">SurfaceRepresentation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/representation/trajectory-representation.js~TrajectoryRepresentation.html">TrajectoryRepresentation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/representation/validation-representation.js~ValidationRepresentation.html">ValidationRepresentation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-BallAndStickRepresentationParameters">BallAndStickRepresentationParameters</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-DistanceRepresentationParameters">DistanceRepresentationParameters</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-LabelRepresentationParameters">LabelRepresentationParameters</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-RepresentationParameters">RepresentationParameters</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-StructureRepresentationParameters">StructureRepresentationParameters</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-SurfaceRepresentationParameters">SurfaceRepresentationParameters</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-TrajectoryRepresentationParameters">TrajectoryRepresentationParameters</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">stage</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/stage/mouse-observer.js~MouseObserver.html">MouseObserver</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/stage/stage.js~Stage.html">Stage</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-MouseSignals">MouseSignals</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-StageParameters">StageParameters</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-StageSignals">StageSignals</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">store</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/store/atom-store.js~AtomStore.html">AtomStore</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/store/atom-type.js~AtomType.html">AtomType</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/store/bond-store.js~BondStore.html">BondStore</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/store/chain-store.js~ChainStore.html">ChainStore</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/store/model-store.js~ModelStore.html">ModelStore</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/store/residue-store.js~ResidueStore.html">ResidueStore</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/store/residue-type.js~ResidueType.html">ResidueType</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/store/store.js~Store.html">Store</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">structure</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/structure/entity.js~Entity.html">Entity</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/structure/structure-view.js~StructureView.html">StructureView</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/structure/structure.js~Structure.html">Structure</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-assignResidueTypeBonds">assignResidueTypeBonds</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-StructureExtraData">StructureExtraData</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-StructureHeader">StructureHeader</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">surface</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/surface/molecular-surface.js~MolecularSurface.html">MolecularSurface</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/surface/surface.js~Surface.html">Surface</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/surface/volume.js~Volume.html">Volume</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-AVHash">AVHash</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-MolecularSurfaceParameters">MolecularSurfaceParameters</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">symmetry</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/symmetry/assembly.js~Assembly.html">Assembly</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/symmetry/unitcell.js~Unitcell.html">Unitcell</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">trajectory</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/trajectory/trajectory-player.js~TrajectoryPlayer.html">TrajectoryPlayer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/trajectory/trajectory.js~Trajectory.html">Trajectory</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-TrajectoryPlayerParameters">TrajectoryPlayerParameters</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-TrajectoryParameters">TrajectoryParameters</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">utils</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/utils/bitarray.js~BitArray.html">BitArray</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/utils/counter.js~Counter.html">Counter</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-interface">I</span><span data-ice="name"><span><a href="class/src/utils/picker.js~Picker.html">Picker</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-interface">I</span><span data-ice="name"><span><a href="class/src/utils/picker.js~ShapePicker.html">ShapePicker</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-BinaryHeap">BinaryHeap</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Kdtree">Kdtree</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">viewer</div><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-makeImage">makeImage</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Viewer">Viewer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-ImageParameters">ImageParameters</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/viewer/viewer.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">/**
 * @file Viewer
 * @author Alexander Rose &lt;alexander.rose@weirdbyte.de&gt;
 * @private
 */


import {
    PerspectiveCamera, OrthographicCamera,
    Box3, Vector3, Matrix4, Color,
    WebGLRenderer, WebGLRenderTarget,
    NearestFilter, LinearFilter, AdditiveBlending,
    RGBAFormat, FloatType, HalfFloatType, UnsignedByteType,
    ShaderMaterial,
    PlaneGeometry,
    Scene, Mesh, Group,
    Fog, SpotLight, AmbientLight,
    BufferGeometry, BufferAttribute,
    LineSegments
} from &quot;../../lib/three.es6.js&quot;;

import &quot;../shader/BasicLine.vert&quot;;
import &quot;../shader/BasicLine.frag&quot;;
import &quot;../shader/Quad.vert&quot;;
import &quot;../shader/Quad.frag&quot;;

import {
    Debug, Log, Browser, Mobile, WebglErrorMessage,
    setExtensionFragDepth, SupportsReadPixelsFloat, setSupportsReadPixelsFloat
} from &quot;../globals.js&quot;;
import { degToRad } from &quot;../math/math-utils.js&quot;;
import Stats from &quot;./stats.js&quot;;
import { getShader } from &quot;../shader/shader-utils.js&quot;;
import { JitterVectors } from &quot;./viewer-constants.js&quot;;
import {
    makeImage as _makeImage, sortProjectedPosition, updateMaterialUniforms
} from &quot;./viewer-utils&quot;;

import Signal from &quot;../../lib/signals.es6.js&quot;;


const pixelBufferFloat = new Float32Array( 4 );
const pixelBufferUint = new Uint8Array( 4 );


var tmpMatrix = new Matrix4();

function onBeforeRender( renderer, scene, camera, geometry, material/*, group*/ ){

    var u = material.uniforms;
    var updateList = [];

    if( u.objectId ){
        u.objectId.value = SupportsReadPixelsFloat ? this.id : this.id / 255;
        updateList.push( &quot;objectId&quot; );
    }

    if( u.modelViewMatrixInverse || u.modelViewMatrixInverseTranspose ||
        u.modelViewProjectionMatrix || u.modelViewProjectionMatrixInverse
    ){
        this.modelViewMatrix.multiplyMatrices( camera.matrixWorldInverse, this.matrixWorld );
    }

    if( u.modelViewMatrixInverse ){
        u.modelViewMatrixInverse.value.getInverse( this.modelViewMatrix );
        updateList.push( &quot;modelViewMatrixInverse&quot; );
    }

    if( u.modelViewMatrixInverseTranspose ){
        if( u.modelViewMatrixInverse ){
            u.modelViewMatrixInverseTranspose.value.copy(
                u.modelViewMatrixInverse.value
            ).transpose();
        }else{
            u.modelViewMatrixInverseTranspose.value
                .getInverse( this.modelViewMatrix )
                .transpose();
        }
        updateList.push( &quot;modelViewMatrixInverseTranspose&quot; );
    }

    if( u.modelViewProjectionMatrix ){
        camera.updateProjectionMatrix();
        u.modelViewProjectionMatrix.value.multiplyMatrices(
            camera.projectionMatrix, this.modelViewMatrix
        );
        updateList.push( &quot;modelViewProjectionMatrix&quot; );
    }

    if( u.modelViewProjectionMatrixInverse ){
        if( u.modelViewProjectionMatrix ){
            tmpMatrix.copy(
                u.modelViewProjectionMatrix.value
            );
            u.modelViewProjectionMatrixInverse.value.getInverse(
                tmpMatrix
            );
        }else{
            camera.updateProjectionMatrix();
            tmpMatrix.multiplyMatrices(
                camera.projectionMatrix, this.modelViewMatrix
            );
            u.modelViewProjectionMatrixInverse.value.getInverse(
                tmpMatrix
            );
        }
        updateList.push( &quot;modelViewProjectionMatrixInverse&quot; );
    }

    if( updateList.length ){

        var materialProperties = renderer.properties.get( material );

        if( materialProperties.program ){

            var gl = renderer.getContext();
            var p = materialProperties.program;
            gl.useProgram( p.program );
            var pu = p.getUniforms();

            updateList.forEach( function( name ){
                pu.setValue( gl, name, u[ name ].value );
            } );

        }

    }

}


/**
 * Viewer class
 * @class
 * @param {String|Element} [idOrElement] - dom id or element
 */
function Viewer( idOrElement ){

    var signals = {
        ticked: new Signal()
    };

    var container;
    if( typeof idOrElement === &quot;string&quot; ){
        container = document.getElementById( idOrElement );
    }else if( idOrElement instanceof Element ){
        container = idOrElement;
    }else{
        container = document.createElement( &apos;div&apos; );
    }

    var width, height;
    if ( container === document.body ) {
        width = window.innerWidth || 1;
        height = window.innerHeight || 1;
    } else {
        var box = container.getBoundingClientRect();
        width = box.width || 1;
        height = box.height || 1;
    }

    var rendering, renderPending, lastRenderedPicking, isStill;
    var sampleLevel, cDist, bRadius;

    var parameters;
    initParams();

    var stats;
    initStats();

    var perspectiveCamera, orthographicCamera, camera;
    initCamera();

    var scene, pointLight, ambientLight;
    var rotationGroup, translationGroup, modelGroup, pickingGroup, backgroundGroup, helperGroup;
    initScene();

    var renderer, supportsHalfFloat;
    var pickingTarget, sampleTarget, holdTarget;
    var compositeUniforms, compositeMaterial, compositeCamera, compositeScene;
    if( initRenderer() === false ){
        this.container = container;
        Log.error( &quot;Viewer: could not initialize renderer&quot; );
        return;
    }

    var boundingBoxMesh;
    var boundingBox = new Box3();
    var boundingBoxSize = new Vector3();
    var boundingBoxLength = 0;
    initHelper();

    // fog &amp; background
    setBackground();
    setFog();

    var distVector = new Vector3();

    var info = {
        memory: {
            programs: 0,
            geometries: 0,
            textures: 0
        },
        render: {
            calls: 0,
            vertices: 0,
            faces: 0,
            points: 0
        }
    };

    function initParams(){

        parameters = {

            fogColor: new Color( 0x000000 ),
            fogNear: 50,
            fogFar: 100,

            backgroundColor: new Color( 0x000000 ),

            cameraType: &quot;perspective&quot;,
            cameraFov: 40,
            cameraZ: -80, // FIXME initial value should be automatically determined

            clipNear: 0,
            clipFar: 100,
            clipDist: 10,

            lightColor: new Color( 0xdddddd ),
            lightIntensity: 1.0,
            ambientColor: new Color( 0xdddddd ),
            ambientIntensity: 0.2,

            sampleLevel: 0

        };

    }

    function initCamera(){

        var lookAt = new Vector3( 0, 0, 0 );

        perspectiveCamera = new PerspectiveCamera(
            parameters.cameraFov, width / height
        );
        perspectiveCamera.position.z = parameters.cameraZ;
        perspectiveCamera.lookAt( lookAt );

        orthographicCamera = new OrthographicCamera(
            width / -2, width / 2,
            height / 2, height / -2
        );
        orthographicCamera.position.z = parameters.cameraZ;
        orthographicCamera.lookAt( lookAt );

        if( parameters.cameraType === &quot;orthographic&quot; ){
            camera = orthographicCamera;
        }else{  // parameters.cameraType === &quot;perspective&quot;
            camera = perspectiveCamera;
        }
        camera.updateProjectionMatrix();

    }

    function initRenderer(){

        var dpr = window.devicePixelRatio;

        try{
            renderer = new WebGLRenderer( {
                preserveDrawingBuffer: true,
                alpha: true,
                antialias: true
            } );
        }catch( e ){
            container.innerHTML = WebglErrorMessage;
            return false;
        }
        renderer.setPixelRatio( dpr );
        renderer.setSize( width, height );
        renderer.autoClear = false;
        renderer.sortObjects = true;

        // var gl = renderer.getContext();
        // console.log( gl.getContextAttributes().antialias );
        // console.log( gl.getParameter(gl.SAMPLES) );

        setExtensionFragDepth( renderer.extensions.get( &quot;EXT_frag_depth&quot; ) );
        renderer.extensions.get( &apos;OES_element_index_uint&apos; );

        setSupportsReadPixelsFloat(
            ( renderer.extensions.get( &apos;OES_texture_float&apos; ) &amp;&amp;
                renderer.extensions.get( &quot;WEBGL_color_buffer_float&quot; ) ) ||
            ( Browser === &quot;Chrome&quot; &amp;&amp;
                renderer.extensions.get( &apos;OES_texture_float&apos; ) )
        );

        container.appendChild( renderer.domElement );

        var dprWidth = width * dpr;
        var dprHeight = height * dpr;

        // picking texture

        renderer.extensions.get( &apos;OES_texture_float&apos; );
        supportsHalfFloat = renderer.extensions.get( &apos;OES_texture_half_float&apos; );
        renderer.extensions.get( &quot;WEBGL_color_buffer_float&quot; );

        pickingTarget = new WebGLRenderTarget(
            dprWidth, dprHeight,
            {
                minFilter: NearestFilter,
                magFilter: NearestFilter,
                stencilBuffer: false,
                format: RGBAFormat,
                type: SupportsReadPixelsFloat ? FloatType : UnsignedByteType
            }
        );
        pickingTarget.texture.generateMipmaps = false;

        // ssaa textures

        sampleTarget = new WebGLRenderTarget(
            dprWidth, dprHeight,
            {
                minFilter: LinearFilter,
                magFilter: LinearFilter,
                format: RGBAFormat,
            }
        );

        holdTarget = new WebGLRenderTarget(
            dprWidth, dprHeight,
            {
                minFilter: NearestFilter,
                magFilter: NearestFilter,
                format: RGBAFormat,
                // problems on mobile so use UnsignedByteType there
                // see https://github.com/arose/ngl/issues/191
                type: Mobile ? UnsignedByteType : (
                    supportsHalfFloat ? HalfFloatType :
                        ( SupportsReadPixelsFloat ? FloatType : UnsignedByteType )
                )

            }
        );

        compositeUniforms = {
            &quot;tForeground&quot;: { type: &quot;t&quot;, value: null },
            &quot;scale&quot;: { type: &quot;f&quot;, value: 1.0 }
        };

        compositeMaterial = new ShaderMaterial( {
            uniforms: compositeUniforms,
            vertexShader: getShader( &quot;Quad.vert&quot; ),
            fragmentShader: getShader( &quot;Quad.frag&quot; ),
            premultipliedAlpha: true,
            transparent: true,
            blending: AdditiveBlending,
            depthTest: false,
            depthWrite: false
        } );

        compositeCamera = new OrthographicCamera( -1, 1, 1, -1, 0, 1 );
        compositeScene = new Scene().add( new Mesh(
            new PlaneGeometry( 2, 2 ), compositeMaterial
        ) );

    }

    function initScene(){

        if( !scene ){
            scene = new Scene();
        }

        rotationGroup = new Group();
        rotationGroup.name = &quot;rotationGroup&quot;;
        scene.add( rotationGroup );

        translationGroup = new Group();
        translationGroup.name = &quot;translationGroup&quot;;
        rotationGroup.add( translationGroup );

        modelGroup = new Group();
        modelGroup.name = &quot;modelGroup&quot;;
        translationGroup.add( modelGroup );

        pickingGroup = new Group();
        pickingGroup.name = &quot;pickingGroup&quot;;
        translationGroup.add( pickingGroup );

        backgroundGroup = new Group();
        backgroundGroup.name = &quot;backgroundGroup&quot;;
        translationGroup.add( backgroundGroup );

        helperGroup = new Group();
        helperGroup.name = &quot;helperGroup&quot;;
        translationGroup.add( helperGroup );

        // fog

        scene.fog = new Fog();

        // light

        pointLight = new SpotLight(
            parameters.lightColor, parameters.lightIntensity
        );
        scene.add( pointLight );

        ambientLight = new AmbientLight(
            parameters.ambientLight, parameters.ambientIntensity
        );
        scene.add( ambientLight );

    }

    function initHelper(){

        var indices = new Uint16Array( [
            0, 1, 1, 2, 2, 3, 3, 0, 4, 5, 5, 6,
            6, 7, 7, 4, 0, 4, 1, 5, 2, 6, 3, 7
        ] );
        var positions = new Float32Array( 8 * 3 );

        var bbGeometry = new BufferGeometry();
        bbGeometry.setIndex( new BufferAttribute( indices, 1 ) );
        bbGeometry.addAttribute( &apos;position&apos;, new BufferAttribute( positions, 3 ) );
        var bbMaterial = new ShaderMaterial( {
            uniforms: { &quot;uColor&quot;: { value: new Color( &quot;skyblue&quot; ) } },
            vertexShader: getShader( &quot;BasicLine.vert&quot; ),
            fragmentShader: getShader( &quot;BasicLine.frag&quot; ),
            linewidth: 2
        } );

        boundingBoxMesh = new LineSegments( bbGeometry, bbMaterial );
        helperGroup.add( boundingBoxMesh );

    }

    function updateHelper(){

        var position = boundingBoxMesh.geometry.attributes.position;
        var array = position.array;

        var min = boundingBox.min;
        var max = boundingBox.max;

        array[  0 ] = max.x; array[  1 ] = max.y; array[  2 ] = max.z;
        array[  3 ] = min.x; array[  4 ] = max.y; array[  5 ] = max.z;
        array[  6 ] = min.x; array[  7 ] = min.y; array[  8 ] = max.z;
        array[  9 ] = max.x; array[ 10 ] = min.y; array[ 11 ] = max.z;
        array[ 12 ] = max.x; array[ 13 ] = max.y; array[ 14 ] = min.z;
        array[ 15 ] = min.x; array[ 16 ] = max.y; array[ 17 ] = min.z;
        array[ 18 ] = min.x; array[ 19 ] = min.y; array[ 20 ] = min.z;
        array[ 21 ] = max.x; array[ 22 ] = min.y; array[ 23 ] = min.z;

        position.needsUpdate = true;

        if( !boundingBox.isEmpty() ){
            boundingBoxMesh.geometry.computeBoundingSphere();
        }

    }

    function initStats(){

        stats = new Stats();

    }

    function add( buffer, instanceList ){

        // Log.time( &quot;Viewer.add&quot; );

        if( instanceList ){
            instanceList.forEach( function( instance ){
                addBuffer( buffer, instance );
            } );
        }else{
            addBuffer( buffer );
        }

        if( buffer.background ){
            backgroundGroup.add( buffer.group );
            backgroundGroup.add( buffer.wireframeGroup );
        }else{
            modelGroup.add( buffer.group );
            modelGroup.add( buffer.wireframeGroup );
        }

        if( buffer.pickable ){
            pickingGroup.add( buffer.pickingGroup );
        }

        if( Debug ) updateHelper();

        // Log.timeEnd( &quot;Viewer.add&quot; );

    }

    function addBuffer( buffer, instance ){

        // Log.time( &quot;Viewer.addBuffer&quot; );

        function setUserData( object ){
            if( object instanceof Group ){
                object.children.forEach( setUserData );
            }else{
                object.userData.buffer = buffer;
                object.userData.instance = instance;
                object.onBeforeRender = onBeforeRender;
            }
        }

        var mesh = buffer.getMesh();
        if( instance ){
            mesh.applyMatrix( instance.matrix );
        }
        setUserData( mesh );
        buffer.group.add( mesh );

        var wireframeMesh = buffer.getWireframeMesh();
        if( instance ){
            // wireframeMesh.applyMatrix( instance.matrix );
            wireframeMesh.matrix.copy( mesh.matrix );
            wireframeMesh.position.copy( mesh.position );
            wireframeMesh.quaternion.copy( mesh.quaternion );
            wireframeMesh.scale.copy( mesh.scale );
        }
        setUserData( wireframeMesh );
        buffer.wireframeGroup.add( wireframeMesh );

        if( buffer.pickable ){

            var pickingMesh = buffer.getPickingMesh();
            if( instance ){
                // pickingMesh.applyMatrix( instance.matrix );
                pickingMesh.matrix.copy( mesh.matrix );
                pickingMesh.position.copy( mesh.position );
                pickingMesh.quaternion.copy( mesh.quaternion );
                pickingMesh.scale.copy( mesh.scale );
            }
            setUserData( pickingMesh );
            buffer.pickingGroup.add( pickingMesh );

        }

        if( instance ){
            updateBoundingBox( buffer.geometry, buffer.matrix, instance.matrix );
        }else{
            updateBoundingBox( buffer.geometry, buffer.matrix );
        }

        // Log.timeEnd( &quot;Viewer.addBuffer&quot; );

    }

    function remove( buffer ){

        translationGroup.children.forEach( function( group ){
            group.remove( buffer.group );
            group.remove( buffer.wireframeGroup );
        } );

        if( buffer.pickable ){
            pickingGroup.remove( buffer.pickingGroup );
        }

        updateBoundingBox();
        if( Debug ) updateHelper();

        // requestRender();

    }

    function updateBoundingBox( geometry, matrix, instanceMatrix ){

        function updateGeometry( geometry, matrix, instanceMatrix ){

            if( !geometry.boundingBox ){
                geometry.computeBoundingBox();
            }

            var geoBoundingBox = geometry.boundingBox.clone();

            if( matrix ){
                geoBoundingBox.applyMatrix4( matrix );
            }
            if( instanceMatrix ){
                geoBoundingBox.applyMatrix4( instanceMatrix );
            }

            if( geoBoundingBox.min.equals( geoBoundingBox.max ) ){
                // mainly to give a single impostor geometry some volume
                // as it is only expanded in the shader on the GPU
                geoBoundingBox.expandByScalar( 5 );
            }

            boundingBox.union( geoBoundingBox );

        }

        function updateNode( node ){

            if( node.geometry !== undefined ){
                var matrix, instanceMatrix;
                if( node.userData.buffer ){
                    matrix = node.userData.buffer.matrix;
                }
                if( node.userData.instance ){
                    instanceMatrix = node.userData.instance.matrix;
                }
                updateGeometry( node.geometry, matrix, instanceMatrix );
            }

        }

        if( geometry ){
            updateGeometry( geometry, matrix, instanceMatrix );
        }else{
            boundingBox.makeEmpty();
            modelGroup.traverse( updateNode );
            backgroundGroup.traverse( updateNode );
        }

        boundingBox.getSize( boundingBoxSize );
        boundingBoxLength = boundingBoxSize.length();

    }

    function getImage(){

        return new Promise( function( resolve ){
            renderer.domElement.toBlob( resolve, &quot;image/png&quot; );
        } );

    }

    function makeImage( params ){

        return _makeImage( this, params );

    }

    function setLight( color, intensity, ambientColor, ambientIntensity ){

        var p = parameters;

        if( color !== undefined ) p.lightColor.set( color );
        if( intensity !== undefined ) p.lightIntensity = intensity;
        if( ambientColor !== undefined ) p.ambientColor.set( ambientColor );
        if( ambientIntensity !== undefined ) p.ambientIntensity = ambientIntensity;

        requestRender();

    }

    function setFog( color, near, far ){

        var p = parameters;

        if( color !== undefined ) p.fogColor.set( color );
        if( near !== undefined ) p.fogNear = near;
        if( far !== undefined ) p.fogFar = far;

        requestRender();

    }

    function setBackground( color ){

        var p = parameters;

        if( color ) p.backgroundColor.set( color );

        setFog( p.backgroundColor );
        renderer.setClearColor( p.backgroundColor, 0 );
        renderer.domElement.style.backgroundColor = p.backgroundColor.getStyle();

        requestRender();

    }

    function setSampling( level ){

        if( level !== undefined ){
            parameters.sampleLevel = level;
            sampleLevel = level;
        }

        requestRender();

    }

    function setCamera( type, fov ){

        var p = parameters;

        if( type ) p.cameraType = type;
        if( fov ) p.cameraFov = fov;

        if( p.cameraType === &quot;orthographic&quot; ){
            if( camera !== orthographicCamera ){
                camera = orthographicCamera;
                camera.position.copy( perspectiveCamera.position );
                camera.up.copy( perspectiveCamera.up );
                updateZoom();
            }
        }else{  // p.cameraType === &quot;perspective&quot;
            if( camera !== perspectiveCamera ){
                camera = perspectiveCamera;
                camera.position.copy( orthographicCamera.position );
                camera.up.copy( orthographicCamera.up );
            }
        }

        perspectiveCamera.fov = p.cameraFov;
        camera.updateProjectionMatrix();

        requestRender();

    }

    function setClip( near, far, dist ){

        var p = parameters;

        if( near !== undefined ) p.clipNear = near;
        if( far !== undefined ) p.clipFar = far;
        if( dist !== undefined ) p.clipDist = dist;

        requestRender();

    }

    function setSize( _width, _height ){

        width = _width || 1;
        height = _height || 1;

        perspectiveCamera.aspect = width / height;
        orthographicCamera.left = -width / 2;
        orthographicCamera.right = width / 2;
        orthographicCamera.top = height / 2;
        orthographicCamera.bottom = -height / 2;
        camera.updateProjectionMatrix();

        var dpr = window.devicePixelRatio;

        renderer.setPixelRatio( dpr );
        renderer.setSize( width, height );

        var dprWidth = width * dpr;
        var dprHeight = height * dpr;

        pickingTarget.setSize( dprWidth, dprHeight );
        sampleTarget.setSize( dprWidth, dprHeight );
        holdTarget.setSize( dprWidth, dprHeight );

        requestRender();

    }

    function handleResize(){

        if( container === document.body ){
            setSize( window.innerWidth, window.innerHeight );
        }else{
            var box = container.getBoundingClientRect();
            setSize( box.width, box.height );
        }

    }

    function updateInfo( reset ){

        var memory = info.memory;
        var render = info.render;

        if( reset ){

            memory.programs = 0;
            memory.geometries = 0;
            memory.textures = 0;

            render.calls = 0;
            render.vertices = 0;
            render.faces = 0;
            render.points = 0;

        }else{

            var rInfo = renderer.info;
            var rMemory = rInfo.memory;
            var rRender = rInfo.render;

            memory.programs = rMemory.programs;
            memory.geometries = rMemory.geometries;
            memory.textures = rMemory.textures;

            render.calls += rRender.calls;
            render.vertices += rRender.vertices;
            render.faces += rRender.faces;
            render.points += rRender.points;

        }

    }

    function animate(){

        signals.ticked.dispatch( stats );
        var delta = performance.now() - stats.startTime;

        if( delta &gt; 500 &amp;&amp; !isStill &amp;&amp; sampleLevel &lt; 3 &amp;&amp; sampleLevel !== -1 ){
            var currentSampleLevel = sampleLevel;
            sampleLevel = 3;
            renderPending = true;
            render();
            isStill = true;
            sampleLevel = currentSampleLevel;
            if( Debug ) Log.log( &quot;rendered still frame&quot; );
        }

        requestAnimationFrame( animate );

    }

    function pick( x, y ){

        x *= window.devicePixelRatio;
        y *= window.devicePixelRatio;

        let pid, instance, picker;
        const pixelBuffer = SupportsReadPixelsFloat ? pixelBufferFloat : pixelBufferUint;

        render( true );
        renderer.readRenderTargetPixels(
            pickingTarget, x, y, 1, 1, pixelBuffer
        );

        if( SupportsReadPixelsFloat ){
            pid =
                ( ( Math.round( pixelBuffer[0] * 255 ) &lt;&lt; 16 ) &amp; 0xFF0000 ) |
                ( ( Math.round( pixelBuffer[1] * 255 ) &lt;&lt; 8 ) &amp; 0x00FF00 ) |
                ( ( Math.round( pixelBuffer[2] * 255 ) ) &amp; 0x0000FF );
        }else{
            pid =
                ( pixelBuffer[0] &lt;&lt; 16 ) |
                ( pixelBuffer[1] &lt;&lt; 8 ) |
                ( pixelBuffer[2] );
        }

        const oid = Math.round( pixelBuffer[ 3 ] );
        const object = pickingGroup.getObjectById( oid );
        if( object ){
            instance = object.userData.instance;
            picker = object.userData.buffer.picking;
        }

        // if( Debug ){
        //     const rgba = Array.apply( [], pixelBuffer );
        //     Log.log( pixelBuffer );
        //     Log.log(
        //         &quot;picked color&quot;,
        //         rgba.map( c =&gt; { return c.toPrecision( 2 ) } )
        //     );
        //     Log.log( &quot;picked pid&quot;, pid );
        //     Log.log( &quot;picked oid&quot;, oid );
        //     Log.log( &quot;picked object&quot;, object );
        //     Log.log( &quot;picked instance&quot;, instance );
        //     Log.log( &quot;picked position&quot;, x, y );
        //     Log.log( &quot;devicePixelRatio&quot;, window.devicePixelRatio );
        // }

        return {
            &quot;pid&quot;: pid,
            &quot;instance&quot;: instance,
            &quot;picker&quot;: picker
        };

    }

    function requestRender(){

        if( renderPending ){
            // Log.info( &quot;there is still a &apos;render&apos; call pending&quot; );
            return;
        }

        // start gathering stats anew after inactivity
        if( performance.now() - stats.startTime &gt; 22 ){
            stats.begin();
            isStill = false;
        }

        renderPending = true;

        requestAnimationFrame( function requestRenderAnimation(){
            render();
            stats.update();
        } );

    }

    function updateZoom(){

        var fov = degToRad( perspectiveCamera.fov );
        var _height = 2 * Math.tan( fov / 2 ) * -camera.position.z;
        orthographicCamera.zoom = height / _height;

    }

    function __updateClipping(){

        var p = parameters;

        // clipping

        // cDist = distVector.copy( camera.position )
        //             .sub( controls.target ).length();
        cDist = distVector.copy( camera.position ).length();
        // console.log( &quot;cDist&quot;, cDist )
        if( !cDist ){
            // recover from a broken (NaN) camera position
            camera.position.set( 0, 0, p.cameraZ );
            cDist = Math.abs( p.cameraZ );
        }

        bRadius = Math.max( 10, boundingBoxLength * 0.5 );
        bRadius += boundingBox.getCenter( distVector ).length();
        // console.log( &quot;bRadius&quot;, bRadius )
        if( bRadius === Infinity || bRadius === -Infinity || isNaN( bRadius ) ){
            // console.warn( &quot;something wrong with bRadius&quot; );
            bRadius = 50;
        }

        var nearFactor = ( 50 - p.clipNear ) / 50;
        var farFactor = - ( 50 - p.clipFar ) / 50;
        camera.near = cDist - ( bRadius * nearFactor );
        camera.far = cDist + ( bRadius * farFactor );

        // fog

        var fogNearFactor = ( 50 - p.fogNear ) / 50;
        var fogFarFactor = - ( 50 - p.fogFar ) / 50;
        var fog = scene.fog;
        fog.color.set( p.fogColor );
        fog.near = cDist - ( bRadius * fogNearFactor );
        fog.far = cDist + ( bRadius * fogFarFactor );

        if( camera.type === &quot;PerspectiveCamera&quot; ){
            camera.near = Math.max( 0.1, p.clipDist, camera.near );
            camera.far = Math.max( 1, camera.far );
            fog.near = Math.max( 0.1, fog.near );
            fog.far = Math.max( 1, fog.far );
        }else if( camera.type === &quot;OrthographicCamera&quot; ){
            if( p.clipNear === 0 &amp;&amp; p.clipDist &gt; 0 &amp;&amp; cDist + camera.zoom &gt; 2 * -p.clipDist ){
                camera.near += camera.zoom + p.clipDist;
            }
        }

    }

    function __updateCamera(){

        camera.updateMatrix();
        camera.updateMatrixWorld( true );
        camera.matrixWorldInverse.getInverse( camera.matrixWorld );
        camera.updateProjectionMatrix();

        updateMaterialUniforms( scene, camera, renderer, cDist, bRadius );
        sortProjectedPosition( scene, camera );

    }

    function __setVisibility( model, picking, background, helper ){

        modelGroup.visible = model;
        pickingGroup.visible = picking;
        backgroundGroup.visible = background;
        helperGroup.visible = helper;

    }

    function __updateLights(){

        // distVector.copy( camera.position ).sub( controls.target )
        //     .setLength( boundingBoxLength * 100 );
        distVector.copy( camera.position ).setLength( boundingBoxLength * 100 );

        pointLight.position.copy( camera.position ).add( distVector );
        pointLight.color.set( parameters.lightColor );
        pointLight.intensity = parameters.lightIntensity;

        ambientLight.color.set( parameters.ambientColor );
        ambientLight.intensity = parameters.ambientIntensity;

    }

    function __renderPickingGroup(){

        renderer.clearTarget( pickingTarget );
        __setVisibility( false, true, false, false );
        renderer.render( scene, camera, pickingTarget );
        updateInfo();
        renderer.setRenderTarget( null );  // back to standard render target

        // if( Debug ){
        //     __setVisibility( false, true, false, true );

        //     renderer.clear();
        //     renderer.render( scene, camera );
        // }

    }

    function __renderModelGroup( renderTarget ){

        if( renderTarget ){
            renderer.clearTarget( renderTarget );
        }else{
            renderer.clear();
        }

        __setVisibility( false, false, true, false );
        renderer.render( scene, camera, renderTarget );
        if( renderTarget ){
            renderer.clearTarget( renderTarget, false, true, false );
        }else{
            renderer.clearDepth();
        }
        updateInfo();

        __setVisibility( true, false, false, Debug );
        renderer.render( scene, camera, renderTarget );
        updateInfo();

    }

    function __renderSuperSample(){

        // based on the Supersample Anti-Aliasing Render Pass
        // contributed to three.js by bhouston / http://clara.io/
        //
        // This manual approach to SSAA re-renders the scene ones for
        // each sample with camera jitter and accumulates the results.
        // References: https://en.wikipedia.org/wiki/Supersampling

        var offsetList = JitterVectors[ Math.max( 0, Math.min( sampleLevel, 5 ) ) ];

        var baseSampleWeight = 1.0 / offsetList.length;
        var roundingRange = 1 / 32;

        compositeUniforms.tForeground.value = sampleTarget.texture;

        var _width = sampleTarget.width;
        var _height = sampleTarget.height;

        // render the scene multiple times, each slightly jitter offset
        // from the last and accumulate the results.
        for ( var i = 0; i &lt; offsetList.length; ++i ){

            var offset = offsetList[ i ];
            camera.setViewOffset(
                _width, _height, offset[ 0 ], offset[ 1 ], _width, _height
            );
            __updateCamera();

            var sampleWeight = baseSampleWeight;
            // the theory is that equal weights for each sample lead to an
            // accumulation of rounding errors.
            // The following equation varies the sampleWeight per sample
            // so that it is uniformly distributed across a range of values
            // whose rounding errors cancel each other out.
            var uniformCenteredDistribution = ( -0.5 + ( i + 0.5 ) / offsetList.length );
            sampleWeight += roundingRange * uniformCenteredDistribution;
            compositeUniforms.scale.value = sampleWeight;

            __renderModelGroup( sampleTarget );
            renderer.render(
                compositeScene, compositeCamera, holdTarget, ( i === 0 )
            );

        }

        compositeUniforms.scale.value = 1.0;
        compositeUniforms.tForeground.value = holdTarget.texture;

        renderer.render( compositeScene, compositeCamera, null, true );

        camera.view = null;

    }

    function render( picking ){

        if( rendering ){
            Log.warn( &quot;tried to call &apos;render&apos; from within &apos;render&apos;&quot; );
            return;
        }

        // Log.time( &quot;Viewer.render&quot; );

        rendering = true;

        __updateClipping();
        __updateCamera();
        __updateLights();

        // render

        updateInfo( true );

        if( picking ){
            if( !lastRenderedPicking ) __renderPickingGroup();
        }else if( sampleLevel &gt; 0 ){
            __renderSuperSample();
        }else{
            __renderModelGroup();
        }
        lastRenderedPicking = picking;

        rendering = false;
        renderPending = false;

        // Log.timeEnd( &quot;Viewer.render&quot; );
        // Log.log( info.memory, info.render );

    }

    function clear(){

        Log.log( &quot;scene cleared&quot; );
        scene.remove( rotationGroup );
        initScene();
        renderer.clear();

    }

    // API

    this.container = container;
    this.stats = stats;
    this.signals = signals;

    this.rotationGroup = rotationGroup;
    this.translationGroup = translationGroup;

    this.add = add;
    this.remove = remove;
    this.clear = clear;

    this.getImage = getImage;
    this.makeImage = makeImage;

    this.setLight = setLight;
    this.setFog = setFog;
    this.setBackground = setBackground;
    this.setSampling = setSampling;
    this.setCamera = setCamera;
    this.setClip = setClip;
    this.setSize = setSize;
    this.handleResize = handleResize;

    this.pick = pick;
    this.requestRender = requestRender;
    this.render = render;
    this.animate = animate;
    this.updateZoom = updateZoom;
    this.updateHelper = updateHelper;

    this.renderer = renderer;
    this.scene = scene;
    this.perspectiveCamera = perspectiveCamera;
    this.boundingBox = boundingBox;
    this.updateBoundingBox = function(){
        updateBoundingBox();
        if( Debug ) updateHelper();
    }

    Object.defineProperties( this, {
        camera: { get: function(){ return camera; } },
        width: { get: function(){ return width; } },
        height: { get: function(){ return height; } },
        sampleLevel: { get: function(){ return sampleLevel; } }
    } );

}

Viewer.prototype.constructor = Viewer;


export default Viewer;
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.5.2)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-69549173-1', 'auto');
    ga('send', 'pageview');
</script></body>
</html>
