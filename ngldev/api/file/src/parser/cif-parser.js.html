<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../">
  <title data-ice="title">src/parser/cif-parser.js | NGL Viewer API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header><span>NGL@0.10.2-7</span>
  <a href="./">Home</a>
  <a href="./manual/index.html" data-ice="manualHeaderLink">Manual</a>
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <a href="./../gallery/index.html">Gallery</a><a data-ice="repoURL" href="https://github.com/arose/ngl.git" class="repo-url-github">Repository</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/script.js~Script.html">Script</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/selection.js~Selection.html">Selection</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-binarySearchIndexOf">binarySearchIndexOf</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-Browser">Browser</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-ColormakerRegistry">ColormakerRegistry</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-ExtensionFragDepth">ExtensionFragDepth</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-Mobile">Mobile</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-Version">Version</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-external">E</span><span data-ice="name"><span><a href="https://threejs.org/docs/#api/math/Box3">Box3</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-external">E</span><span data-ice="name"><span><a href="https://threejs.org/docs/#api/core/BufferGeometry">BufferGeometry</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-external">E</span><span data-ice="name"><span><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String">Char</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-external">E</span><span data-ice="name"><span><a href="https://threejs.org/docs/#api/math/Color">Color</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-external">E</span><span data-ice="name"><span><a href="https://threejs.org/docs/#api/math/Euler">Euler</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-external">E</span><span data-ice="name"><span><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number">Float</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-external">E</span><span data-ice="name"><span><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number">Integer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-external">E</span><span data-ice="name"><span><a href="https://threejs.org/docs/#api/math/Matrix3">Matrix3</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-external">E</span><span data-ice="name"><span><a href="https://threejs.org/docs/#api/math/Matrix4">Matrix4</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-external">E</span><span data-ice="name"><span><a href="https://threejs.org/docs/#api/math/Plane">Plane</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-external">E</span><span data-ice="name"><span><a href="https://threejs.org/docs/#api/math/Quaternion">Quaternion</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-external">E</span><span data-ice="name"><span><a href="https://millermedeiros.github.io/js-signals/docs/symbols/Signal.html">Signal</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-external">E</span><span data-ice="name"><span><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/TypedArray">TypedArray</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-external">E</span><span data-ice="name"><span><a href="https://threejs.org/docs/#api/math/Vector2">Vector2</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-external">E</span><span data-ice="name"><span><a href="https://threejs.org/docs/#api/math/Vector3">Vector3</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">align</div><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-superpose">superpose</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">animation</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/animation/animation.js~AnimationList.html">AnimationList</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/animation/animation.js~MoveAnimation.html">MoveAnimation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/animation/animation.js~RockAnimation.html">RockAnimation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/animation/animation.js~RotateAnimation.html">RotateAnimation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/animation/animation.js~SpinAnimation.html">SpinAnimation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/animation/animation.js~ValueAnimation.html">ValueAnimation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/animation/animation.js~ZoomAnimation.html">ZoomAnimation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-interface">I</span><span data-ice="name"><span><a href="class/src/animation/animation.js~Animation.html">Animation</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">buffer</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/buffer/arrow-buffer.js~ArrowBuffer.html">ArrowBuffer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/buffer/cone-buffer.js~ConeBuffer.html">ConeBuffer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/buffer/conegeometry-buffer.js~ConeGeometryBuffer.html">ConeGeometryBuffer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/buffer/contour-buffer.js~ContourBuffer.html">ContourBuffer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/buffer/cylinder-buffer.js~CylinderBuffer.html">CylinderBuffer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/buffer/cylindergeometry-buffer.js~CylinderGeometryBuffer.html">CylinderGeometryBuffer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/buffer/cylinderimpostor-buffer.js~CylinderImpostorBuffer.html">CylinderImpostorBuffer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/buffer/doublesided-buffer.js~DoubleSidedBuffer.html">DoubleSidedBuffer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/buffer/ellipsoid-buffer.js~EllipsoidBuffer.html">EllipsoidBuffer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/buffer/ellipsoidgeometry-buffer.js~EllipsoidGeometryBuffer.html">EllipsoidGeometryBuffer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/buffer/hyperballstick-buffer.js~HyperballStickBuffer.html">HyperballStickBuffer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/buffer/hyperballstickimpostor-buffer.js~HyperballStickImpostorBuffer.html">HyperballStickImpostorBuffer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/buffer/image-buffer.js~ImageBuffer.html">ImageBuffer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/buffer/line-buffer.js~LineBuffer.html">LineBuffer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/buffer/mesh-buffer.js~MeshBuffer.html">MeshBuffer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/buffer/point-buffer.js~PointBuffer.html">PointBuffer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/buffer/ribbon-buffer.js~RibbonBuffer.html">RibbonBuffer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/buffer/sphere-buffer.js~SphereBuffer.html">SphereBuffer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/buffer/spheregeometry-buffer.js~SphereGeometryBuffer.html">SphereGeometryBuffer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/buffer/sphereimpostor-buffer.js~SphereImpostorBuffer.html">SphereImpostorBuffer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/buffer/surface-buffer.js~SurfaceBuffer.html">SurfaceBuffer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/buffer/text-buffer.js~TextBuffer.html">TextBuffer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/buffer/trace-buffer.js~TraceBuffer.html">TraceBuffer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/buffer/tubemesh-buffer.js~TubeMeshBuffer.html">TubeMeshBuffer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/buffer/vector-buffer.js~VectorBuffer.html">VectorBuffer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-interface">I</span><span data-ice="name"><span><a href="class/src/buffer/alignedbox-buffer.js~AlignedBoxBuffer.html">AlignedBoxBuffer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-interface">I</span><span data-ice="name"><span><a href="class/src/buffer/box-buffer.js~BoxBuffer.html">BoxBuffer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-interface">I</span><span data-ice="name"><span><a href="class/src/buffer/buffer.js~Buffer.html">Buffer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-interface">I</span><span data-ice="name"><span><a href="class/src/buffer/geometry-buffer.js~GeometryBuffer.html">GeometryBuffer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-interface">I</span><span data-ice="name"><span><a href="class/src/buffer/mapped-buffer.js~MappedBuffer.html">MappedBuffer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-interface">I</span><span data-ice="name"><span><a href="class/src/buffer/quad-buffer.js~QuadBuffer.html">QuadBuffer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-BufferParameters">BufferParameters</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-TextBufferParameters">TextBufferParameters</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">color</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/color/atomindex-colormaker.js~AtomindexColormaker.html">AtomindexColormaker</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/color/bfactor-colormaker.js~BfactorColormaker.html">BfactorColormaker</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/color/chainid-colormaker.js~ChainidColormaker.html">ChainidColormaker</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/color/chainindex-colormaker.js~ChainindexColormaker.html">ChainindexColormaker</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/color/chainname-colormaker.js~ChainnameColormaker.html">ChainnameColormaker</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/color/colormaker-registry.js~ColormakerRegistry.html">ColormakerRegistry</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/color/densityfit-colormaker.js~DensityfitColormaker.html">DensityfitColormaker</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/color/electrostatic-colormaker.js~ElectrostaticColormaker.html">ElectrostaticColormaker</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/color/element-colormaker.js~ElementColormaker.html">ElementColormaker</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/color/entityindex-colormaker.js~EntityindexColormaker.html">EntityindexColormaker</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/color/entitytype-colormaker.js~EntitytypeColormaker.html">EntitytypeColormaker</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/color/geoquality-colormaker.js~GeoqualityColormaker.html">GeoqualityColormaker</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/color/hydrophobicity-colormaker.js~HydrophobicityColormaker.html">HydrophobicityColormaker</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/color/modelindex-colormaker.js~ModelindexColormaker.html">ModelindexColormaker</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/color/moleculetype-colormaker.js~MoleculetypeColormaker.html">MoleculetypeColormaker</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/color/occupancy-colormaker.js~OccupancyColormaker.html">OccupancyColormaker</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/color/random-colormaker.js~RandomColormaker.html">RandomColormaker</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/color/residueindex-colormaker.js~ResidueindexColormaker.html">ResidueindexColormaker</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/color/resname-colormaker.js~ResnameColormaker.html">ResnameColormaker</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/color/selection-colormaker.js~SelectionColormaker.html">SelectionColormaker</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/color/sstruc-colormaker.js~SstrucColormaker.html">SstrucColormaker</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/color/uniform-colormaker.js~UniformColormaker.html">UniformColormaker</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/color/value-colormaker.js~ValueColormaker.html">ValueColormaker</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/color/volume-colormaker.js~VolumeColormaker.html">VolumeColormaker</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-interface">I</span><span data-ice="name"><span><a href="class/src/color/colormaker.js~Colormaker.html">Colormaker</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-ColormakerParameters">ColormakerParameters</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">component</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/component/annotation.js~Annotation.html">Annotation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/component/representation-component.js~RepresentationComponent.html">RepresentationComponent</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/component/script-component.js~ScriptComponent.html">ScriptComponent</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/component/shape-component.js~ShapeComponent.html">ShapeComponent</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/component/structure-component.js~StructureComponent.html">StructureComponent</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/component/surface-component.js~SurfaceComponent.html">SurfaceComponent</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/component/trajectory-component.js~TrajectoryComponent.html">TrajectoryComponent</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/component/volume-component.js~VolumeComponent.html">VolumeComponent</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-interface">I</span><span data-ice="name"><span><a href="class/src/component/component.js~Component.html">Component</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-ComponentParameters">ComponentParameters</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-ComponentSignals">ComponentSignals</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-RepresentationComponentSignals">RepresentationComponentSignals</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-StructureComponentSignals">StructureComponentSignals</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-TrajectoryComponentParameters">TrajectoryComponentParameters</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-TrajectoryComponentSignals">TrajectoryComponentSignals</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">controls</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/controls/animation-controls.js~AnimationControls.html">AnimationControls</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/controls/component-controls.js~ComponentControls.html">ComponentControls</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/controls/mouse-actions.js~MouseActions.html">MouseActions</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/controls/mouse-controls.js~MouseControls.html">MouseControls</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/controls/picking-controls.js~PickingControls.html">PickingControls</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/controls/picking-proxy.js~PickingProxy.html">PickingProxy</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/controls/trackball-controls.js~TrackballControls.html">TrackballControls</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/controls/viewer-controls.js~ViewerControls.html">ViewerControls</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-TriggerString">TriggerString</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-PickingData">PickingData</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-OrientationMatrix">OrientationMatrix</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">geometry</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/geometry/shape.js~Shape.html">Shape</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">loader</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/loader/loader.js~Loader.html">Loader</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/loader/parser-loader.js~ParserLoader.html">ParserLoader</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/loader/plugin-loader.js~PluginLoader.html">PluginLoader</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/loader/script-loader.js~ScriptLoader.html">ScriptLoader</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-autoLoad">autoLoad</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-LoaderParameters">LoaderParameters</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">math</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/math/principal-axes.js~PrincipalAxes.html">PrincipalAxes</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-quicksortIP">quicksortIP</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-lineLineIntersect">lineLineIntersect</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">parser</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/parser/csv-parser.js~CsvParser.html">CsvParser</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">proxy</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/proxy/atom-proxy.js~AtomProxy.html">AtomProxy</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/proxy/bond-proxy.js~BondProxy.html">BondProxy</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/proxy/chain-proxy.js~ChainProxy.html">ChainProxy</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/proxy/model-proxy.js~ModelProxy.html">ModelProxy</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/proxy/polymer.js~Polymer.html">Polymer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/proxy/residue-proxy.js~ResidueProxy.html">ResidueProxy</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">representation</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/representation/axes-representation.js~AxesRepresentation.html">AxesRepresentation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/representation/backbone-representation.js~BackboneRepresentation.html">BackboneRepresentation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/representation/ballandstick-representation.js~BallAndStickRepresentation.html">BallAndStickRepresentation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/representation/base-representation.js~BaseRepresentation.html">BaseRepresentation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/representation/buffer-representation.js~BufferRepresentation.html">BufferRepresentation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/representation/cartoon-representation.js~CartoonRepresentation.html">CartoonRepresentation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/representation/distance-representation.js~DistanceRepresentation.html">DistanceRepresentation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/representation/label-representation.js~LabelRepresentation.html">LabelRepresentation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/representation/licorice-representation.js~LicoriceRepresentation.html">LicoriceRepresentation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/representation/line-representation.js~LineRepresentation.html">LineRepresentation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/representation/representation.js~Representation.html">Representation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/representation/structure-representation.js~StructureRepresentation.html">StructureRepresentation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/representation/surface-representation.js~SurfaceRepresentation.html">SurfaceRepresentation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/representation/trajectory-representation.js~TrajectoryRepresentation.html">TrajectoryRepresentation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/representation/validation-representation.js~ValidationRepresentation.html">ValidationRepresentation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-BallAndStickRepresentationParameters">BallAndStickRepresentationParameters</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-DistanceRepresentationParameters">DistanceRepresentationParameters</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-LabelRepresentationParameters">LabelRepresentationParameters</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-RepresentationParameters">RepresentationParameters</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-StructureRepresentationParameters">StructureRepresentationParameters</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-SurfaceRepresentationParameters">SurfaceRepresentationParameters</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-TrajectoryRepresentationParameters">TrajectoryRepresentationParameters</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">stage</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/stage/mouse-observer.js~MouseObserver.html">MouseObserver</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/stage/stage.js~Stage.html">Stage</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-MouseSignals">MouseSignals</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-StageParameters">StageParameters</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-StageSignals">StageSignals</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">store</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/store/atom-store.js~AtomStore.html">AtomStore</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/store/atom-type.js~AtomType.html">AtomType</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/store/bond-store.js~BondStore.html">BondStore</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/store/chain-store.js~ChainStore.html">ChainStore</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/store/model-store.js~ModelStore.html">ModelStore</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/store/residue-store.js~ResidueStore.html">ResidueStore</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/store/residue-type.js~ResidueType.html">ResidueType</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/store/store.js~Store.html">Store</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">structure</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/structure/entity.js~Entity.html">Entity</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/structure/structure-view.js~StructureView.html">StructureView</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/structure/structure.js~Structure.html">Structure</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-assignResidueTypeBonds">assignResidueTypeBonds</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-StructureExtraData">StructureExtraData</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-StructureHeader">StructureHeader</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">surface</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/surface/molecular-surface.js~MolecularSurface.html">MolecularSurface</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/surface/surface.js~Surface.html">Surface</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/surface/volume.js~Volume.html">Volume</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-AVHash">AVHash</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-MolecularSurfaceParameters">MolecularSurfaceParameters</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">symmetry</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/symmetry/assembly.js~Assembly.html">Assembly</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/symmetry/unitcell.js~Unitcell.html">Unitcell</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">trajectory</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/trajectory/trajectory-player.js~TrajectoryPlayer.html">TrajectoryPlayer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/trajectory/trajectory.js~Trajectory.html">Trajectory</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-TrajectoryPlayerParameters">TrajectoryPlayerParameters</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-TrajectoryParameters">TrajectoryParameters</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">utils</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/utils/bitarray.js~BitArray.html">BitArray</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/utils/counter.js~Counter.html">Counter</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-interface">I</span><span data-ice="name"><span><a href="class/src/utils/picker.js~Picker.html">Picker</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-interface">I</span><span data-ice="name"><span><a href="class/src/utils/picker.js~ShapePicker.html">ShapePicker</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-BinaryHeap">BinaryHeap</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Kdtree">Kdtree</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">viewer</div><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-makeImage">makeImage</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Viewer">Viewer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-ImageParameters">ImageParameters</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/parser/cif-parser.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">/**
 * @file Cif Parser
 * @author Alexander Rose &lt;alexander.rose@weirdbyte.de&gt;
 * @private
 */


import { Vector3, Matrix4 } from &quot;../../lib/three.es6.js&quot;;

import { Debug, Log, ParserRegistry } from &quot;../globals.js&quot;;
import StructureParser from &quot;./structure-parser.js&quot;;
import { HelixTypes } from &quot;./pdb-parser.js&quot;;
import Entity from &quot;../structure/entity.js&quot;;
import Unitcell from &quot;../symmetry/unitcell.js&quot;;
import Assembly from &quot;../symmetry/assembly.js&quot;;
import Selection from &quot;../selection.js&quot;;
import {
    assignResidueTypeBonds, assignSecondaryStructure, buildUnitcellAssembly,
    calculateBonds, calculateSecondaryStructure
} from &quot;../structure/structure-utils.js&quot;;


const reWhitespace = /\s+/;
const reQuotedWhitespace = /&apos;((?:(?!&apos;\s).)*)&apos;|&quot;((?:(?!&quot;\s).)*)&quot;|(\S+)/g;
const reDoubleQuote = /&quot;/g;
const reTrimQuotes = /^[&apos;&quot;]+|[&apos;&quot;]+$/g;


function trimQuotes( str ){
    if( str &amp;&amp; str[0] === str[ str.length-1 ] &amp;&amp; ( str[0] === &quot;&apos;&quot; || str[0] === &apos;&quot;&apos; ) ){
        return str.substring( 1,  str.length-1 );
    }else{
        return str;
    }
}

function ensureArray( dict, field ){
    if( !Array.isArray( dict[ field ] ) ){
        Object.keys( dict ).forEach( function( key ){
            dict[ key ] = [ dict[ key ] ];
        } );
    }
}

function hasValue( d ){
    return d !== &quot;?&quot;;
}

function cifDefaults( value, defaultValue ){
    return hasValue( value ) ? value : defaultValue;
}

function getBondOrder( valueOrder ){
    switch( valueOrder.toLowerCase() ){
        case &quot;?&quot;:  // assume single bond
        case &quot;sing&quot;:
            return 1;
        case &quot;doub&quot;:
            return 2;
        case &quot;trip&quot;:
            return 3;
        case &quot;quad&quot;:
            return 4;
    }
    return 0;
}


function parseChemComp( cif, structure, structureBuilder ){

    var atomStore = structure.atomStore;
    var atomMap = structure.atomMap;

    var i, n;
    var cc = cif.chem_comp;
    var cca = cif.chem_comp_atom;
    var ccb = cif.chem_comp_bond;

    if( cc ){

        if( cc.name ){
            structure.title = cc.name.trim().replace( reTrimQuotes, &quot;&quot; );
        }
        if( cc.id ){
            structure.id = cc.id.trim().replace( reTrimQuotes, &quot;&quot; );
        }

    }

    var atomnameDict = {};

    if( cca ){

        var atomname, element, resname, resno;
        n = cca.comp_id.length;

        for( i = 0; i &lt; n; ++i ){

            atomStore.growIfFull();

            atomname = cca.atom_id[ i ].replace( reDoubleQuote, &apos;&apos; );
            element = cca.type_symbol[ i ];

            atomnameDict[ atomname ] = i;
            atomStore.atomTypeId[ i ] = atomMap.add( atomname, element );

            atomStore.x[ i ] = cca.model_Cartn_x[ i ];
            atomStore.y[ i ] = cca.model_Cartn_y[ i ];
            atomStore.z[ i ] = cca.model_Cartn_z[ i ];
            atomStore.serial[ i ] = i;

            resname = cca.pdbx_component_comp_id[ i ];
            resno = cca.pdbx_residue_numbering ? cca.pdbx_residue_numbering[ i ] : 1;

            structureBuilder.addAtom( 0, &quot;&quot;, &quot;&quot;, resname, resno, 1 );

        }

        for( i = 0; i &lt; n; ++i ){

            var j = i + n;

            atomStore.growIfFull();

            atomname = cca.atom_id[ i ].replace( reDoubleQuote, &apos;&apos; );
            element = cca.type_symbol[ i ];

            atomStore.atomTypeId[ j ] = atomMap.add( atomname, element );

            atomStore.x[ j ] = cca.pdbx_model_Cartn_x_ideal[ i ];
            atomStore.y[ j ] = cca.pdbx_model_Cartn_y_ideal[ i ];
            atomStore.z[ j ] = cca.pdbx_model_Cartn_z_ideal[ i ];
            atomStore.serial[ j ] = j;

            resname = cca.pdbx_component_comp_id[ i ];
            resno = cca.pdbx_residue_numbering ? cca.pdbx_residue_numbering[ i ] : 1;

            structureBuilder.addAtom( 1, &quot;&quot;, &quot;&quot;, resname, resno, 1 );

        }

    }

    if( cca &amp;&amp; ccb ){

        var atomname1, atomname2, bondOrder;
        n = ccb.comp_id.length;
        var na = cca.comp_id.length;

        var ap1 = structure.getAtomProxy();
        var ap2 = structure.getAtomProxy();

        for( i = 0; i &lt; n; ++i ){

            atomname1 = ccb.atom_id_1[ i ].replace( reDoubleQuote, &apos;&apos; );
            atomname2 = ccb.atom_id_2[ i ].replace( reDoubleQuote, &apos;&apos; );
            bondOrder = getBondOrder( ccb.value_order[ i ] );

            ap1.index = atomnameDict[ atomname1 ];
            ap2.index = atomnameDict[ atomname2 ];
            structure.bondStore.growIfFull();
            structure.bondStore.addBond( ap1, ap2, bondOrder );

            ap1.index += na;
            ap2.index += na;
            structure.bondStore.growIfFull();
            structure.bondStore.addBond( ap1, ap2, bondOrder );

        }

    }

}


function parseCore( cif, structure, structureBuilder ){

    var atomStore = structure.atomStore;
    var atomMap = structure.atomMap;

    if( cif.data ){
        structure.id = cif.data;
        structure.name = cif.data;
    }

    structure.unitcell = new Unitcell( {
        a: parseFloat( cif.cell_length_a ),
        b: parseFloat( cif.cell_length_b ),
        c: parseFloat( cif.cell_length_c ),
        alpha: parseFloat( cif.cell_angle_alpha ),
        beta: parseFloat( cif.cell_angle_beta ),
        gamma: parseFloat( cif.cell_angle_gamma ),
        spacegroup: trimQuotes( cif.symmetry_space_group_name_H )
    } );

    const v = new Vector3();
    const c = new Vector3();
    const n = cif.atom_site_type_symbol.length;

    for( let i = 0; i &lt; n; ++i ){

        atomStore.growIfFull();

        const atomname = cif.atom_site_label[ i ];
        const element = cif.atom_site_type_symbol[ i ];

        atomStore.atomTypeId[ i ] = atomMap.add( atomname, element );

        v.set(
            cif.atom_site_fract_x[ i ],
            cif.atom_site_fract_y[ i ],
            cif.atom_site_fract_z[ i ]
        );
        v.applyMatrix4( structure.unitcell.fracToCart );
        c.add( v );

        atomStore.x[ i ] = v.x;
        atomStore.y[ i ] = v.y;
        atomStore.z[ i ] = v.z;
        if( cif.atom_site_occupancy ){
            atomStore.occupancy[ i ] = parseFloat( cif.atom_site_occupancy[ i ] );
        }
        atomStore.serial[ i ] = i;

        structureBuilder.addAtom( 0, &quot;&quot;, &quot;&quot;, &quot;HET&quot;, 1, 1 );

    }

    c.divideScalar( n );
    structure.center = c;
    buildUnitcellAssembly( structure );

    const v2 = new Vector3();
    const v3 = new Vector3();
    const ml = structure.biomolDict.SUPERCELL.partList[ 0 ].matrixList;

    let k = n;

    function covalent( idx ){
        return atomMap.get( atomStore.atomTypeId[ idx ] ).covalent;
    }
    const identityMatrix = new Matrix4();

    for( let i = 0; i &lt; n; ++i ){

        const covalentI = covalent( i );

        v.set(
            atomStore.x[ i ],
            atomStore.y[ i ],
            atomStore.z[ i ]
        );

        ml.forEach( function( m ){

            if( identityMatrix.equals( m ) ) return;

            v2.copy( v );
            v2.applyMatrix4( m );

            for( let j = 0; j &lt; n; ++j ){

                v3.set(
                    atomStore.x[ j ],
                    atomStore.y[ j ],
                    atomStore.z[ j ]
                );

                const distSquared = v2.distanceToSquared( v3 );
                const d = covalent( j ) + covalentI;
                const d1 = d + 0.3;
                const d2 = d - 0.5;

                if( distSquared &lt; ( d1 * d1 ) &amp;&amp; distSquared &gt; ( d2 * d2 ) ){

                    atomStore.growIfFull();

                    atomStore.atomTypeId[ k ] = atomStore.atomTypeId[ i ];
                    atomStore.x[ k ] = v2.x;
                    atomStore.y[ k ] = v2.y;
                    atomStore.z[ k ] = v2.z;
                    atomStore.occupancy[ k ] = atomStore.occupancy[ i ];
                    atomStore.serial[ k ] = k;
                    atomStore.altloc[ k ] = &quot;A&quot;.charCodeAt( 0 );

                    structureBuilder.addAtom( 0, &quot;&quot;, &quot;&quot;, &quot;HET&quot;, 1, 1 );

                    k += 1;
                    return;

                }

            }

        } );


    }

}


function processSecondaryStructure( cif, structure, asymIdDict ){

    var helices = [];
    var sheets = [];

    var i, il, begIcode, endIcode;

    // get helices
    var sc = cif.struct_conf;

    if( sc ){

        ensureArray( sc, &quot;id&quot; );

        for( i = 0, il = sc.beg_auth_seq_id.length; i &lt; il; ++i ){
            var helixType = parseInt( sc.pdbx_PDB_helix_class[ i ] );
            if( !Number.isNaN( helixType ) ){
                begIcode = sc.pdbx_beg_PDB_ins_code[ i ];
                endIcode = sc.pdbx_end_PDB_ins_code[ i ];
                helices.push( [
                    asymIdDict[ sc.beg_label_asym_id[ i ] ],
                    parseInt( sc.beg_auth_seq_id[ i ] ),
                    cifDefaults( begIcode, &quot;&quot; ),
                    asymIdDict[ sc.end_label_asym_id[ i ] ],
                    parseInt( sc.end_auth_seq_id[ i ] ),
                    cifDefaults( endIcode, &quot;&quot; ),
                    ( HelixTypes[ helixType ] || HelixTypes[&quot;&quot;] ).charCodeAt( 0 )
                ] );
            }
        }

    }

    // get sheets
    var ssr = cif.struct_sheet_range;

    if( ssr ){

        ensureArray( ssr, &quot;id&quot; );

        for( i = 0, il = ssr.beg_auth_seq_id.length; i &lt; il; ++i ){
            begIcode = ssr.pdbx_beg_PDB_ins_code[ i ];
            endIcode = ssr.pdbx_end_PDB_ins_code[ i ];
            sheets.push( [
                asymIdDict[ ssr.beg_label_asym_id[ i ] ],
                parseInt( ssr.beg_auth_seq_id[ i ] ),
                cifDefaults( begIcode, &quot;&quot; ),
                asymIdDict[ ssr.end_label_asym_id[ i ] ],
                parseInt( ssr.end_auth_seq_id[ i ] ),
                cifDefaults( endIcode, &quot;&quot; )
            ] );
        }

    }

    if( sc || ssr ){
        return {
            helices: helices,
            sheets: sheets
        };
    }else{
        return false;
    }

}


function processSymmetry( cif, structure, asymIdDict ){

    // biomol &amp; ncs processing
    var operDict = {};
    var biomolDict = structure.biomolDict;

    if( cif.pdbx_struct_oper_list ){

        var biomolOp = cif.pdbx_struct_oper_list;
        ensureArray( biomolOp, &quot;id&quot; );

        biomolOp.id.forEach( function( id, i ){

            var m = new Matrix4();
            var elms = m.elements;

            elms[  0 ] = parseFloat( biomolOp[ &quot;matrix[1][1]&quot; ][ i ] );
            elms[  1 ] = parseFloat( biomolOp[ &quot;matrix[1][2]&quot; ][ i ] );
            elms[  2 ] = parseFloat( biomolOp[ &quot;matrix[1][3]&quot; ][ i ] );

            elms[  4 ] = parseFloat( biomolOp[ &quot;matrix[2][1]&quot; ][ i ] );
            elms[  5 ] = parseFloat( biomolOp[ &quot;matrix[2][2]&quot; ][ i ] );
            elms[  6 ] = parseFloat( biomolOp[ &quot;matrix[2][3]&quot; ][ i ] );

            elms[  8 ] = parseFloat( biomolOp[ &quot;matrix[3][1]&quot; ][ i ] );
            elms[  9 ] = parseFloat( biomolOp[ &quot;matrix[3][2]&quot; ][ i ] );
            elms[ 10 ] = parseFloat( biomolOp[ &quot;matrix[3][3]&quot; ][ i ] );

            elms[  3 ] = parseFloat( biomolOp[ &quot;vector[1]&quot; ][ i ] );
            elms[  7 ] = parseFloat( biomolOp[ &quot;vector[2]&quot; ][ i ] );
            elms[ 11 ] = parseFloat( biomolOp[ &quot;vector[3]&quot; ][ i ] );

            m.transpose();

            operDict[ id ] = m;

        } );

    }

    if( cif.pdbx_struct_assembly_gen ){

        var gen = cif.pdbx_struct_assembly_gen;
        ensureArray( gen, &quot;assembly_id&quot; );

        var getMatrixDict = function( expr ){

            var matDict = {};

            var l = expr.replace( /[\(\)&apos;]/g, &quot;&quot; ).split( &quot;,&quot; );

            l.forEach( function( e ){

                if( e.includes( &quot;-&quot; ) ){

                    var es = e.split( &quot;-&quot; );

                    var j = parseInt( es[ 0 ] );
                    var m = parseInt( es[ 1 ] );

                    for( ; j &lt;= m; ++j ){

                        matDict[ j ] = operDict[ j ];

                    }

                }else{

                    matDict[ e ] = operDict[ e ];

                }

            } );

            return matDict;

        };

        gen.assembly_id.forEach( function( id, i ){

            var md = {};
            var oe = gen.oper_expression[ i ].replace( /[&apos;&quot;]\(|[&apos;&quot;]/g, &quot;&quot; );

            if( oe.includes( &quot;)(&quot; ) || oe.indexOf( &quot;(&quot; ) &gt; 0 ){

                oe = oe.split( &quot;(&quot; );

                var md1 = getMatrixDict( oe[ 0 ] );
                var md2 = getMatrixDict( oe[ 1 ] );

                Object.keys( md1 ).forEach( function( k1 ){

                    Object.keys( md2 ).forEach( function( k2 ){

                        var mat = new Matrix4();

                        mat.multiplyMatrices( md1[ k1 ], md2[ k2 ] );
                        md[ k1 + &quot;x&quot; + k2 ] = mat;

                    } );

                } );

            }else{

                md = getMatrixDict( oe );

            }

            var matrixList = [];
            for( var k in md ){
                matrixList.push( md[ k ] );
            }

            var name = id;
            if( /^(0|[1-9][0-9]*)$/.test( name ) ) name = &quot;BU&quot; + name;

            var chainList = gen.asym_id_list[ i ].split( &quot;,&quot; );
            for( var j = 0, jl = chainList.length; j &lt; jl; ++j ){
                chainList[ j ] = asymIdDict[ chainList[ j ] ];
            }

            if( biomolDict[ name ] === undefined ){
                biomolDict[ name ] = new Assembly( name );
            }
            biomolDict[ name ].addPart( matrixList, chainList );

        } );

    }

    // non-crystallographic symmetry operations
    if( cif.struct_ncs_oper ){

        var ncsOp = cif.struct_ncs_oper;
        ensureArray( ncsOp, &quot;id&quot; );

        var ncsName = &quot;NCS&quot;;
        biomolDict[ ncsName ] = new Assembly( ncsName );
        var ncsPart = biomolDict[ ncsName ].addPart();

        ncsOp.id.forEach( function( id, i ){

            // ignore &apos;given&apos; operators
            if( ncsOp.code[ i ] === &quot;given&quot; ) return;

            var m = new Matrix4();
            var elms = m.elements;

            elms[  0 ] = parseFloat( ncsOp[ &quot;matrix[1][1]&quot; ][ i ] );
            elms[  1 ] = parseFloat( ncsOp[ &quot;matrix[1][2]&quot; ][ i ] );
            elms[  2 ] = parseFloat( ncsOp[ &quot;matrix[1][3]&quot; ][ i ] );

            elms[  4 ] = parseFloat( ncsOp[ &quot;matrix[2][1]&quot; ][ i ] );
            elms[  5 ] = parseFloat( ncsOp[ &quot;matrix[2][2]&quot; ][ i ] );
            elms[  6 ] = parseFloat( ncsOp[ &quot;matrix[2][3]&quot; ][ i ] );

            elms[  8 ] = parseFloat( ncsOp[ &quot;matrix[3][1]&quot; ][ i ] );
            elms[  9 ] = parseFloat( ncsOp[ &quot;matrix[3][2]&quot; ][ i ] );
            elms[ 10 ] = parseFloat( ncsOp[ &quot;matrix[3][3]&quot; ][ i ] );

            elms[  3 ] = parseFloat( ncsOp[ &quot;vector[1]&quot; ][ i ] );
            elms[  7 ] = parseFloat( ncsOp[ &quot;vector[2]&quot; ][ i ] );
            elms[ 11 ] = parseFloat( ncsOp[ &quot;vector[3]&quot; ][ i ] );

            m.transpose();

            ncsPart.matrixList.push( m );

        } );

        if( ncsPart.matrixList.length === 0 ){
            delete biomolDict[ ncsName ];
        }

    }

    // cell &amp; symmetry
    var unitcellDict = {};

    if( cif.cell ){

        var cell = cif.cell;

        var a = parseFloat( cell.length_a );
        var b = parseFloat( cell.length_b );
        var c = parseFloat( cell.length_c );

        var box = new Float32Array( 9 );
        box[ 0 ] = a;
        box[ 4 ] = b;
        box[ 8 ] = c;
        structure.boxes.push( box );

        unitcellDict.a = a;
        unitcellDict.b = b;
        unitcellDict.c = c;
        unitcellDict.alpha = parseFloat( cell.angle_alpha );
        unitcellDict.beta = parseFloat( cell.angle_beta );
        unitcellDict.gamma = parseFloat( cell.angle_gamma );

    }

    if( cif.symmetry ){

        unitcellDict.spacegroup = trimQuotes(
            cif.symmetry[ &quot;space_group_name_H-M&quot; ]
        );

    }

    // origx
    var origx = new Matrix4();

    if( cif.database_PDB_matrix ){

        var origxMat = cif.database_PDB_matrix;
        var origxElms = origx.elements;

        origxElms[  0 ] = parseFloat( origxMat[ &quot;origx[1][1]&quot; ] );
        origxElms[  1 ] = parseFloat( origxMat[ &quot;origx[1][2]&quot; ] );
        origxElms[  2 ] = parseFloat( origxMat[ &quot;origx[1][3]&quot; ] );

        origxElms[  4 ] = parseFloat( origxMat[ &quot;origx[2][1]&quot; ] );
        origxElms[  5 ] = parseFloat( origxMat[ &quot;origx[2][2]&quot; ] );
        origxElms[  6 ] = parseFloat( origxMat[ &quot;origx[2][3]&quot; ] );

        origxElms[  8 ] = parseFloat( origxMat[ &quot;origx[3][1]&quot; ] );
        origxElms[  9 ] = parseFloat( origxMat[ &quot;origx[3][2]&quot; ] );
        origxElms[ 10 ] = parseFloat( origxMat[ &quot;origx[3][3]&quot; ] );

        origxElms[  3 ] = parseFloat( origxMat[ &quot;origx_vector[1]&quot; ] );
        origxElms[  7 ] = parseFloat( origxMat[ &quot;origx_vector[2]&quot; ] );
        origxElms[ 11 ] = parseFloat( origxMat[ &quot;origx_vector[3]&quot; ] );

        origx.transpose();

        unitcellDict.origx = origx;

    }

    // scale
    var scale = new Matrix4();

    if( cif.atom_sites ){

        var scaleMat = cif.atom_sites;
        var scaleElms = scale.elements;

        scaleElms[  0 ] = parseFloat( scaleMat[ &quot;fract_transf_matrix[1][1]&quot; ] );
        scaleElms[  1 ] = parseFloat( scaleMat[ &quot;fract_transf_matrix[1][2]&quot; ] );
        scaleElms[  2 ] = parseFloat( scaleMat[ &quot;fract_transf_matrix[1][3]&quot; ] );

        scaleElms[  4 ] = parseFloat( scaleMat[ &quot;fract_transf_matrix[2][1]&quot; ] );
        scaleElms[  5 ] = parseFloat( scaleMat[ &quot;fract_transf_matrix[2][2]&quot; ] );
        scaleElms[  6 ] = parseFloat( scaleMat[ &quot;fract_transf_matrix[2][3]&quot; ] );

        scaleElms[  8 ] = parseFloat( scaleMat[ &quot;fract_transf_matrix[3][1]&quot; ] );
        scaleElms[  9 ] = parseFloat( scaleMat[ &quot;fract_transf_matrix[3][2]&quot; ] );
        scaleElms[ 10 ] = parseFloat( scaleMat[ &quot;fract_transf_matrix[3][3]&quot; ] );

        scaleElms[  3 ] = parseFloat( scaleMat[ &quot;fract_transf_vector[1]&quot; ] );
        scaleElms[  7 ] = parseFloat( scaleMat[ &quot;fract_transf_vector[2]&quot; ] );
        scaleElms[ 11 ] = parseFloat( scaleMat[ &quot;fract_transf_vector[3]&quot; ] );

        scale.transpose();

        unitcellDict.scale = scale;

    }

    if( unitcellDict.a !== undefined ){
        structure.unitcell = new Unitcell( unitcellDict );
    }else{
        structure.unitcell = undefined;
    }

}


function processConnections( cif, structure, asymIdDict ){

    // add connections
    var sc = cif.struct_conn;

    if( sc ){

        ensureArray( sc, &quot;id&quot; );

        var reDoubleQuote = /&quot;/g;
        var ap1 = structure.getAtomProxy();
        var ap2 = structure.getAtomProxy();
        var atomIndicesCache = {};

        for( var i = 0, il = sc.id.length; i &lt; il; ++i ){

            // ignore:
            // hydrog - hydrogen bond
            // mismat - mismatched base pairs
            // saltbr - ionic interaction

            var conn_type_id = sc.conn_type_id[ i ];
            if( conn_type_id === &quot;hydrog&quot; ||
                conn_type_id === &quot;mismat&quot; ||
                conn_type_id === &quot;saltbr&quot; ) continue;

            // ignore bonds between symmetry mates
            if( sc.ptnr1_symmetry[ i ] !== &quot;1_555&quot; ||
                sc.ptnr2_symmetry[ i ] !== &quot;1_555&quot; ) continue;

            // process:
            // covale - covalent bond
            // covale_base -
            //      covalent modification of a nucleotide base
            // covale_phosphate -
            //      covalent modification of a nucleotide phosphate
            // covale_sugar -
            //      covalent modification of a nucleotide sugar
            // disulf - disulfide bridge
            // metalc - metal coordination
            // modres - covalent residue modification

            var inscode1 = sc.pdbx_ptnr1_PDB_ins_code[ i ];
            var altloc1 = sc.pdbx_ptnr1_label_alt_id[ i ];
            var sele1 = (
                sc.ptnr1_auth_seq_id[ i ] +
                ( hasValue( inscode1 ) ? ( &quot;^&quot; + inscode1 ) : &quot;&quot; ) +
                &quot;:&quot; + asymIdDict[ sc.ptnr1_label_asym_id[ i ] ] +
                &quot;.&quot; + sc.ptnr1_label_atom_id[ i ].replace( reDoubleQuote, &apos;&apos; ) +
                ( hasValue( altloc1 ) ? ( &quot;%&quot; + altloc1 ) : &quot;&quot; )
            );
            var atomIndices1 = atomIndicesCache[ sele1 ];
            if( !atomIndices1 ){
                var selection1 = new Selection( sele1 );
                if( selection1.selection.error ){
                    if( Debug ) Log.warn( &quot;invalid selection for connection&quot;, sele1 );
                    continue;
                }
                atomIndices1 = structure.getAtomIndices( selection1 );
                atomIndicesCache[ sele1 ] = atomIndices1;
            }

            var inscode2 = sc.pdbx_ptnr2_PDB_ins_code[ i ];
            var altloc2 = sc.pdbx_ptnr2_label_alt_id[ i ];
            var sele2 = (
                sc.ptnr2_auth_seq_id[ i ] +
                ( hasValue( inscode2 ) ? ( &quot;^&quot; + inscode2 ) : &quot;&quot; ) +
                &quot;:&quot; + asymIdDict[ sc.ptnr2_label_asym_id[ i ] ] +
                &quot;.&quot; + sc.ptnr2_label_atom_id[ i ].replace( reDoubleQuote, &apos;&apos; ) +
                ( hasValue( altloc2 ) ? ( &quot;%&quot; + altloc2 ) : &quot;&quot; )
            );
            var atomIndices2 = atomIndicesCache[ sele2 ];
            if( !atomIndices2 ){
                var selection2 = new Selection( sele2 );
                if( selection2.selection.error ){
                    if( Debug ) Log.warn( &quot;invalid selection for connection&quot;, sele2 );
                    continue;
                }
                atomIndices2 = structure.getAtomIndices( selection2 );
                atomIndicesCache[ sele2 ] = atomIndices2;
            }

            // cases with more than one atom per selection
            // - #altloc1 to #altloc2
            // - #model to #model
            // - #altloc1 * #model to #altloc2 * #model

            var k = atomIndices1.length;
            var l = atomIndices2.length;

            if( k &gt; l ){
                var tmpA = k;
                k = l;
                l = tmpA;
                var tmpB = atomIndices1;
                atomIndices1 = atomIndices2;
                atomIndices2 = tmpB;
            }

            // console.log( k, l );

            if( k === 0 || l === 0 ){
                if( Debug ) Log.warn( &quot;no atoms found for&quot;, sele1, sele2 );
                continue;
            }

            for( var j = 0; j &lt; l; ++j ){

                ap1.index = atomIndices1[ j % k ];
                ap2.index = atomIndices2[ j ];

                if( ap1 &amp;&amp; ap2 ){
                    structure.bondStore.addBond(
                        ap1, ap2, getBondOrder( sc.pdbx_value_order[ i ] )
                    );
                }else{
                    Log.log( &quot;atoms for connection not found&quot; );
                }

            }

        }

    }

}


function processEntities( cif, structure, chainIndexDict ){

    if( cif.entity ){
        ensureArray( cif.entity, &quot;id&quot; );
        var e = cif.entity;
        var n = e.id.length;
        for( var i = 0; i &lt; n; ++i ){
            var description = e.pdbx_description[ i ];
            var type = e.type[ i ];
            var chainIndexList = Array.from( chainIndexDict[ e.id[ i ] ] );
            structure.entityList[ i ] = new Entity(
                structure, i, description, type, chainIndexList
            );
        }
    }

}


//


class CifParser extends StructureParser{

    get type (){ return &quot;cif&quot;; }

    _parse(){

        // http://mmcif.wwpdb.org/

        Log.time( &quot;CifParser._parse &quot; + this.name );

        var s = this.structure;
        var sb = this.structureBuilder;

        var firstModelOnly = this.firstModelOnly;
        var asTrajectory = this.asTrajectory;
        var cAlphaOnly = this.cAlphaOnly;

        var frames = s.frames;
        var currentFrame, currentCoord;

        var rawline, line;

        //

        var cif = {};
        var asymIdDict = {};
        var chainIndexDict = {};

        var pendingString = false;
        var currentString = null;
        var pendingValue = false;
        var pendingLoop = false;
        var pendingName = false;
        var loopPointers = [];
        var currentLoopIndex = null;
        var currentCategory = null;
        var currentName = null;
        var first = null;
        var pointerNames = [];

        var auth_asym_id, auth_seq_id,
            label_atom_id, label_comp_id, label_asym_id, label_entity_id, label_alt_id,
            group_PDB, id, type_symbol, pdbx_PDB_model_num, pdbx_PDB_ins_code,
            Cartn_x, Cartn_y, Cartn_z, B_iso_or_equiv, occupancy;

        //

        var atomMap = s.atomMap;
        var atomStore = s.atomStore;
        atomStore.resize( this.streamer.data.length / 100 );

        var idx = 0;
        var modelIdx = 0;
        var modelNum;

        function _parseChunkOfLines( _i, _n, lines ){

            for( var i = _i; i &lt; _n; ++i ){

                rawline = lines[i];
                line = rawline.trim();

                if( ( !line &amp;&amp; !pendingString &amp;&amp; !pendingLoop ) || line[0]===&quot;#&quot; ){

                    // Log.log( &quot;NEW BLOCK&quot; );

                    pendingString = false;
                    pendingLoop = false;
                    pendingValue = false;
                    loopPointers.length = 0;
                    currentLoopIndex = null;
                    currentCategory = null;
                    currentName = null;
                    first = null;
                    pointerNames.length = 0;

                }else if( line.substring( 0, 5 )===&quot;data_&quot; ){

                    cif.data = line.substring( 5 ).trim();

                    // Log.log( &quot;DATA&quot;, data );

                }else if( line[0]===&quot;;&quot; ){

                    if( pendingString ){

                        // Log.log( &quot;STRING END&quot;, currentString );

                        if( pendingLoop ){

                            if( currentLoopIndex === loopPointers.length ){
                                currentLoopIndex = 0;
                            }
                            loopPointers[ currentLoopIndex ].push( currentString );
                            currentLoopIndex += 1;

                        }else{

                            if( currentName === false ){
                                cif[ currentCategory ] = currentString;
                            }else{
                                cif[ currentCategory ][ currentName ] = currentString;
                            }

                        }

                        pendingString = false;
                        currentString = null;

                    }else{

                        // Log.log( &quot;STRING START&quot; );

                        pendingString = true;
                        currentString = line.substring( 1 );

                    }

                }else if( line===&quot;loop_&quot; ){

                    // Log.log( &quot;LOOP START&quot; );

                    pendingLoop = true;
                    pendingName = true;
                    loopPointers.length = 0;
                    pointerNames.length = 0;
                    currentLoopIndex = 0;

                }else if( line[0]===&quot;_&quot; ){

                    var keyParts, category, name;

                    if( pendingLoop &amp;&amp; !pendingName ){
                        pendingLoop = false;
                    }

                    if( pendingLoop ){

                        // Log.log( &quot;LOOP KEY&quot;, line );

                        keyParts = line.split( &quot;.&quot; );
                        category = keyParts[ 0 ].substring( 1 );
                        name = keyParts[ 1 ];

                        if( keyParts.length === 1 ){

                            name = false;
                            if( !cif[ category ] ) cif[ category ] = [];
                            loopPointers.push( cif[ category ] );

                        }else{

                            if( !cif[ category ] ) cif[ category ] = {};
                            if( cif[ category ][ name ] ){
                                if( Debug ) Log.warn( category, name, &quot;already exists&quot; );
                            }else{
                                cif[ category ][ name ] = [];
                                loopPointers.push( cif[ category ][ name ] );
                                pointerNames.push( name );
                            }

                        }

                        currentCategory = category;
                        currentName = name;
                        first = true;

                    }else{

                        var keyValuePair = line.match( reQuotedWhitespace );
                        var key = keyValuePair[ 0 ];
                        var value = keyValuePair[ 1 ];
                        keyParts = key.split( &quot;.&quot; );
                        category = keyParts[ 0 ].substring( 1 );
                        name = keyParts[ 1 ];

                        if( keyParts.length === 1 ){

                            name = false;
                            cif[ category ] = value;

                        }else{

                            if( !cif[ category ] ) cif[ category ] = {};

                            if( cif[ category ][ name ] ){
                                if( Debug ) Log.warn( category, name, &quot;already exists&quot; );
                            }else{
                                cif[ category ][ name ] = value;
                            }

                        }

                        if( !value ) pendingValue = true;

                        currentCategory = category;
                        currentName = name;

                    }

                }else{

                    if( pendingString ){

                        // Log.log( &quot;STRING VALUE&quot;, line );

                        currentString += rawline;

                    }else if( pendingLoop ){

                        // Log.log( &quot;LOOP VALUE&quot;, line );

                        if( !line ){

                            continue;

                        }else if( currentCategory===&quot;atom_site&quot; ){

                            const ls = line.split( reWhitespace );

                            if( first ){

                                auth_asym_id = pointerNames.indexOf( &quot;auth_asym_id&quot; );
                                auth_seq_id = pointerNames.indexOf( &quot;auth_seq_id&quot; );
                                label_atom_id = pointerNames.indexOf( &quot;label_atom_id&quot; );
                                label_comp_id = pointerNames.indexOf( &quot;label_comp_id&quot; );
                                label_asym_id = pointerNames.indexOf( &quot;label_asym_id&quot; );
                                label_entity_id = pointerNames.indexOf( &quot;label_entity_id&quot; );
                                label_alt_id = pointerNames.indexOf( &quot;label_alt_id&quot; );
                                Cartn_x = pointerNames.indexOf( &quot;Cartn_x&quot; );
                                Cartn_y = pointerNames.indexOf( &quot;Cartn_y&quot; );
                                Cartn_z = pointerNames.indexOf( &quot;Cartn_z&quot; );
                                id = pointerNames.indexOf( &quot;id&quot; );
                                type_symbol = pointerNames.indexOf( &quot;type_symbol&quot; );
                                group_PDB = pointerNames.indexOf( &quot;group_PDB&quot; );
                                B_iso_or_equiv = pointerNames.indexOf( &quot;B_iso_or_equiv&quot; );
                                pdbx_PDB_model_num = pointerNames.indexOf( &quot;pdbx_PDB_model_num&quot; );

                                pdbx_PDB_ins_code = pointerNames.indexOf( &quot;pdbx_PDB_ins_code&quot; );
                                occupancy = pointerNames.indexOf( &quot;occupancy&quot; );

                                first = false;

                                modelNum = parseInt( ls[ pdbx_PDB_model_num ] );

                                if( asTrajectory ){
                                    currentFrame = [];
                                    currentCoord = 0;
                                }

                            }

                            //

                            const _modelNum = parseInt( ls[ pdbx_PDB_model_num ] );

                            if( modelNum !== _modelNum ){

                                if( asTrajectory ){

                                    if( modelIdx === 0 ){
                                        frames.push( new Float32Array( currentFrame ) );
                                    }

                                    currentFrame = new Float32Array( atomStore.count * 3 );
                                    frames.push( currentFrame );
                                    currentCoord = 0;

                                }

                                modelIdx += 1;

                            }

                            modelNum = _modelNum;

                            if( firstModelOnly &amp;&amp; modelIdx &gt; 0 ) continue;

                            //

                            const atomname = ls[ label_atom_id ].replace( reDoubleQuote, &apos;&apos; );
                            if( cAlphaOnly &amp;&amp; atomname !== &apos;CA&apos; ) continue;

                            const x = parseFloat( ls[ Cartn_x ] );
                            const y = parseFloat( ls[ Cartn_y ] );
                            const z = parseFloat( ls[ Cartn_z ] );

                            if( asTrajectory ){

                                const frameOffset = currentCoord * 3;

                                currentFrame[ frameOffset + 0 ] = x;
                                currentFrame[ frameOffset + 1 ] = y;
                                currentFrame[ frameOffset + 2 ] = z;

                                currentCoord += 1;

                                if( modelIdx &gt; 0 ) continue;

                            }

                            //

                            const resname = ls[ label_comp_id ];
                            const resno = parseInt( ls[ auth_seq_id ] );
                            let inscode = ls[ pdbx_PDB_ins_code ];
                            inscode = ( inscode === &apos;?&apos; ) ? &apos;&apos; : inscode;
                            const chainname = ls[ auth_asym_id ];
                            const chainid = ls[ label_asym_id ];
                            const hetero = ( ls[ group_PDB ][ 0 ] === &apos;H&apos; ) ? 1 : 0;

                            //

                            const element = ls[ type_symbol ];
                            const bfactor = parseFloat( ls[ B_iso_or_equiv ] );
                            const occ = parseFloat( ls[ occupancy ] );
                            let altloc = ls[ label_alt_id ];
                            altloc = ( altloc === &apos;.&apos; ) ? &apos;&apos; : altloc;

                            atomStore.growIfFull();
                            atomStore.atomTypeId[ idx ] = atomMap.add( atomname, element );

                            atomStore.x[ idx ] = x;
                            atomStore.y[ idx ] = y;
                            atomStore.z[ idx ] = z;
                            atomStore.serial[ idx ] = parseInt( ls[ id ] );
                            atomStore.bfactor[ idx ] = isNaN( bfactor ) ? 0 : bfactor;
                            atomStore.occupancy[ idx ] = isNaN( occ ) ? 0 : occ;
                            atomStore.altloc[ idx ] = altloc.charCodeAt( 0 );

                            sb.addAtom( modelIdx, chainname, chainid, resname, resno, hetero, undefined, inscode );

                            if( Debug ){
                                // check if one-to-many (chainname-asymId) relationship is
                                // actually a many-to-many mapping
                                const assignedChainname = asymIdDict[ chainid ];
                                if( assignedChainname !== undefined &amp;&amp; assignedChainname !== chainname ){
                                    if( Debug ) Log.warn( assignedChainname, chainname );
                                }
                            }
                            // chainname mapping: label_asym_id -&gt; auth_asym_id
                            asymIdDict[ chainid ] = chainname;

                            // entity mapping: chainIndex -&gt; label_entity_id
                            const entityId = ls[ label_entity_id ];
                            if( !chainIndexDict[ entityId ] ){
                                chainIndexDict[ entityId ] = new Set();
                            }
                            chainIndexDict[ entityId ].add( s.chainStore.count - 1 );

                            idx += 1;

                        }else{

                            const ls = line.match( reQuotedWhitespace );
                            const nn = ls.length;

                            if( currentLoopIndex === loopPointers.length ){
                                currentLoopIndex = 0;
                            }/*else if( currentLoopIndex + nn &gt; loopPointers.length ){
                                Log.warn( &quot;cif parsing error, wrong number of loop data entries&quot;, nn, loopPointers.length );
                            }*/

                            for( let j = 0; j &lt; nn; ++j ){
                                loopPointers[ currentLoopIndex + j ].push( ls[ j ] );
                            }

                            currentLoopIndex += nn;

                        }

                        pendingName = false;

                    }else if( line[0]===&quot;&apos;&quot; &amp;&amp; line[line.length-1]===&quot;&apos;&quot; ){

                        // Log.log( &quot;NEWLINE STRING&quot;, line );

                        const str = line.substring( 1, line.length - 1 );

                        if( currentName === false ){
                            cif[ currentCategory ] = str;
                        }else{
                            cif[ currentCategory ][ currentName ] = str;
                        }

                    }else if( pendingValue ){

                        // Log.log( &quot;NEWLINE VALUE&quot;, line );

                        if( currentName === false ){
                            cif[ currentCategory ] = line;
                        }else{
                            cif[ currentCategory ][ currentName ] = line;
                        }

                    }else{

                        if( Debug ) Log.log( &quot;CifParser._parse: unknown state&quot;, line );

                    }

                }

            }

        }

        this.streamer.eachChunkOfLines( function( lines/*, chunkNo, chunkCount*/ ){
            _parseChunkOfLines( 0, lines.length, lines );
        } );

        if( cif.chem_comp &amp;&amp; cif.chem_comp_atom ){

            parseChemComp( cif, s, sb );
            sb.finalize();
            s.finalizeAtoms();
            s.finalizeBonds();
            assignResidueTypeBonds( s );

        }else if( cif.atom_site_type_symbol &amp;&amp; cif.atom_site_label &amp;&amp; cif.atom_site_fract_x ){

            parseCore( cif, s, sb );
            sb.finalize();
            s.finalizeAtoms();
            calculateBonds( s );
            s.finalizeBonds();
            // assignResidueTypeBonds( s );

        }else{

            var secStruct = processSecondaryStructure( cif, s, asymIdDict );
            processSymmetry( cif, s, asymIdDict )
            processConnections( cif, s, asymIdDict );
            processEntities( cif, s, chainIndexDict );

            if( cif.struct &amp;&amp; cif.struct.title ){
                s.title = cif.struct.title.trim().replace( reTrimQuotes, &quot;&quot; );
            }
            if( cif.entry &amp;&amp; cif.entry.id ){
                s.id = cif.entry.id.trim().replace( reTrimQuotes, &quot;&quot; );
            }

            // structure header (mimicking biojava)
            if( cif.database_PDB_rev ){
                if( cif.database_PDB_rev.date ){
                    ensureArray( cif.database_PDB_rev, &quot;date&quot; );
                    var dates = cif.database_PDB_rev.date.filter( hasValue );
                    if( dates.length ){
                        s.header.releaseDate = dates[ dates.length - 1 ];
                    }
                }
                if( cif.database_PDB_rev.date_original ){
                    ensureArray( cif.database_PDB_rev, &quot;date_original&quot; );
                    var depDates = cif.database_PDB_rev.date_original.filter( hasValue );
                    if( depDates.length ){
                        s.header.depositionDate = depDates[ depDates.length - 1 ];
                    }
                }
            }
            if( cif.reflns &amp;&amp; cif.reflns.d_resolution_high ){
                if( hasValue( cif.reflns.d_resolution_high ) ){
                    s.header.resolution = parseFloat( cif.reflns.d_resolution_high );
                }
            }else if( cif.refine &amp;&amp; cif.refine.ls_d_res_high ){
                if( hasValue( cif.refine.ls_d_res_high ) ){
                    s.header.resolution = parseFloat( cif.refine.ls_d_res_high );
                }
            }
            if( cif.refine &amp;&amp; cif.refine.ls_R_factor_R_free ){
                if( hasValue( cif.refine.ls_R_factor_R_free ) ){
                    s.header.rFree = parseFloat( cif.refine.ls_R_factor_R_free );
                }
            }
            if( cif.refine &amp;&amp; cif.refine.ls_R_factor_R_work ){
                if( hasValue( cif.refine.ls_R_factor_R_work ) ){
                    s.header.rWork = parseFloat( cif.refine.ls_R_factor_R_work );
                }
            }
            if( cif.exptl &amp;&amp; cif.exptl.method ){
                ensureArray( cif.exptl, &quot;method&quot; );
                s.header.experimentalMethods = cif.exptl.method.map( function( m ){
                    return m.replace( reTrimQuotes, &quot;&quot; );
                } );
            }

            sb.finalize();
            s.finalizeAtoms();
            calculateBonds( s );
            s.finalizeBonds();

            if( !secStruct ){
                calculateSecondaryStructure( s );
            }else{
                assignSecondaryStructure( s, secStruct );
            }
            buildUnitcellAssembly( s );

            s.extraData.cif = cif;

        }

        if( Debug ) Log.timeEnd( &quot;CifParser._parse &quot; + this.name );

    }

}

ParserRegistry.add( &quot;cif&quot;, CifParser );
ParserRegistry.add( &quot;mcif&quot;, CifParser );
ParserRegistry.add( &quot;mmcif&quot;, CifParser );


export default CifParser;
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.5.2)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-69549173-1', 'auto');
    ga('send', 'pageview');
</script></body>
</html>
